<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteCenter OS</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Courier+Prime:wght@400;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
/* ============================
   NoteCenter OS - Styles
   Retro terminal + cute sticky notes theme
   ============================ */

/* ============================
   CSS Variables & Theme Colors
   ============================ */
:root {
    /* Retro Terminal Colors */
    --terminal-green: #33ff33;
    --terminal-dark: #0a0e0a;
    --terminal-glow: #2bff2b;
    --terminal-amber: #ffb000;

    /* Cute Note Colors */
    --note-yellow: #fff59d;
    --note-pink: #f8bbd0;
    --note-blue: #bbdefb;
    --note-green: #c8e6c9;
    --note-purple: #e1bee7;

    /* Category Colors */
    --cat-general: #fff59d;
    --cat-work: #bbdefb;
    --cat-personal: #f8bbd0;
    --cat-ideas: #c8e6c9;

    /* UI Colors */
    --bg-primary: #fef8f0;
    --bg-secondary: #fff;
    --text-primary: #2c2c2c;
    --text-secondary: #666;
    --accent: #ff6b9d;
    --shadow: rgba(0, 0, 0, 0.15);
    --shadow-strong: rgba(0, 0, 0, 0.3);

    /* Fonts */
    --font-display: 'Fredoka', sans-serif;
    --font-body: 'Courier Prime', monospace;
    --font-terminal: 'VT323', monospace;
}

/* ============================
   Dark Mode Theme
   ============================ */
body.dark-mode {
    /* Dark Background Colors */
    --bg-primary: #0d1b1e;
    --bg-secondary: #1a2f35;
    --text-primary: #e0e0e0;
    --text-secondary: #a0a0a0;
    --accent: #ff6b9d;
    --shadow: rgba(0, 0, 0, 0.5);
    --shadow-strong: rgba(0, 0, 0, 0.8);

    /* Adjusted Note Colors for Dark Mode */
    --note-yellow: #4a4520;
    --note-pink: #4a3540;
    --note-blue: #2a3a4a;
    --note-green: #2a4a35;
    --note-purple: #3a2a4a;

    /* Adjusted Category Colors */
    --cat-general: #4a4520;
    --cat-work: #2a3a4a;
    --cat-personal: #4a3540;
    --cat-ideas: #2a4a35;

    /* Neon Accents */
    --neon-cyan: #00fff9;
    --neon-pink: #ff2a6d;
    --neon-glow: rgba(0, 255, 249, 0.5);

    /* Grid Background Pattern */
    background:
        linear-gradient(rgba(0, 255, 249, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 249, 0.03) 1px, transparent 1px),
        var(--bg-primary);
    background-size: 50px 50px;
}

/* ============================
   Theme Variations
   ============================ */
body.theme-amber {
    --terminal-green: #ffb000;
    --terminal-glow: #ffb000;
}

body.theme-matrix {
    --terminal-green: #00ff00;
    --terminal-glow: #00ff00;
}

body.theme-cyan {
    --terminal-green: #00ffff;
    --terminal-glow: #00ffff;
}

body.theme-pink {
    --terminal-green: #ff6bd2;
    --terminal-glow: #ff6bd2;
}

body.theme-red {
    --terminal-green: #ff4444;
    --terminal-glow: #ff4444;
}

body.theme-purple {
    --terminal-green: #cc66ff;
    --terminal-glow: #cc66ff;
}

body.theme-blue {
    --terminal-green: #3399ff;
    --terminal-glow: #3399ff;
}

body.theme-orange {
    --terminal-green: #ff8c00;
    --terminal-glow: #ff8c00;
}

body.theme-white {
    --terminal-green: #e0e0e0;
    --terminal-glow: #ffffff;
}

body.theme-dracula {
    --terminal-green: #bd93f9;
    --terminal-glow: #bd93f9;
}

/* ============================
   Professional Mode Theme
   ============================ */
body.mode-professional {
    /* Professional Typography */
    --font-display: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
    --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;

    /* Professional Colors */
    --bg-primary: #f8fafc;
    --bg-secondary: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --accent: #2563eb;
    --shadow: rgba(0, 0, 0, 0.08);
    --shadow-strong: rgba(0, 0, 0, 0.15);

    /* Professional Note Colors (Muted Pastels) */
    --note-yellow: #fef3c7;
    --note-pink: #fce7f3;
    --note-blue: #dbeafe;
    --note-green: #d1fae5;
    --note-purple: #e9d5ff;

    /* Professional Category Colors */
    --cat-general: #fef3c7;
    --cat-work: #dbeafe;
    --cat-personal: #fce7f3;
    --cat-ideas: #d1fae5;
}

/* Professional Mode + Dark Mode Combined */
body.mode-professional.dark-mode {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --accent: #3b82f6;
    --shadow: rgba(0, 0, 0, 0.4);
    --shadow-strong: rgba(0, 0, 0, 0.7);

    /* Darker professional note colors for dark mode */
    --note-yellow: #422006;
    --note-pink: #500724;
    --note-blue: #0c4a6e;
    --note-green: #064e3b;
    --note-purple: #3b0764;

    --cat-general: #422006;
    --cat-work: #0c4a6e;
    --cat-personal: #500724;
    --cat-ideas: #064e3b;

    /* Remove grid background in professional dark mode */
    background: var(--bg-primary);
}

/* Professional Mode Visual Adjustments */
body.mode-professional .sticky-note {
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 3px var(--shadow);
    transform: none !important; /* No rotation */
}

body.mode-professional .sticky-note:hover {
    transform: none !important; /* No rotation on hover */
    box-shadow: 0 4px 12px var(--shadow-strong);
}

body.mode-professional .header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 3px var(--shadow);
}

body.mode-professional .filter-bar {
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 3px var(--shadow);
}

body.mode-professional .note-btn,
body.mode-professional .filter-btn {
    border: 1px solid rgba(0, 0, 0, 0.15);
}

body.mode-professional .add-note-btn {
    border: none;
    box-shadow: 0 2px 4px var(--shadow);
}

body.mode-professional .add-note-btn:hover {
    box-shadow: 0 4px 8px var(--shadow-strong);
    transform: translateY(-2px);
}

body.mode-professional .nav-tab {
    border-radius: 8px;
}

body.mode-professional .nav-tab:hover {
    transform: none;
}

body.mode-professional .modal-content {
    border-radius: 16px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 20px 60px var(--shadow-strong);
    animation: professionalModalIn 0.2s ease-out;
}

@keyframes professionalModalIn {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

body.mode-professional .modal-content::before {
    display: none; /* Remove rotating border animation */
}

body.mode-professional .modal-header::after {
    display: none; /* Remove floating emoji */
}

body.mode-professional .form-input,
body.mode-professional .form-textarea,
body.mode-professional .form-select {
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 8px;
}

/* Faster transitions in professional mode */
body.mode-professional * {
    transition-duration: 0.15s !important;
}

/* ============================
   Reset & Base Styles
   ============================ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-body);
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
}

/* Smooth Transitions for Theme Switching */
body,
.header,
.filter-bar,
.sticky-note,
.modal-content,
.note-btn,
.filter-btn,
.nav-tab,
.btn,
.form-input,
.form-textarea,
.form-select {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

/* Screen Reader Only */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* ============================
   Boss Mode Styles
   ============================ */
body.boss-mode .notes-section,
body.boss-mode .filter-bar {
    display: none !important;
}

body.boss-mode .main-container {
    grid-template-columns: 1fr;
}

body.boss-mode .terminal-panel {
    display: block !important;
}

.boss-screen {
    display: none;
    padding: 2rem;
    background: var(--terminal-dark);
    color: var(--terminal-green);
    font-family: var(--font-terminal);
    font-size: 1.2rem;
    line-height: 2;
    border-radius: 12px;
    border: 3px solid var(--terminal-green);
}

body.boss-mode .boss-screen {
    display: block;
}

/* ============================
   Header Styles
   ============================ */
.header {
    background: var(--bg-secondary);
    border-bottom: 3px solid var(--text-primary);
    box-shadow: 0 4px 12px var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
    animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
    from { transform: translateY(-100%); }
    to { transform: translateY(0); }
}

.header-content {
    max-width: 1600px;
    margin: 0 auto;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
}

.logo {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent);
}

.logo-icon {
    font-size: 2rem;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.logo-text {
    font-size: inherit;
    font-weight: inherit;
}

.nav-tabs {
    display: flex;
    gap: 0.5rem;
}

.nav-tab {
    font-family: var(--font-display);
    background: transparent;
    border: 2px solid transparent;
    padding: 0.75rem 1.25rem;
    min-height: 48px;
    border-radius: 12px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
}

.nav-tab:hover {
    background: rgba(255, 107, 157, 0.1);
    transform: translateY(-2px);
}

.nav-tab.active {
    background: var(--accent);
    color: white;
    border-color: var(--text-primary);
    font-weight: 600;
}

.nav-tab:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

/* UI Mode Toggle */
.ui-mode-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: auto;
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 600;
}

.ui-mode-toggle-label {
    color: var(--text-secondary);
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

.ui-mode-slider:before {
    content: "üé®"; /* Playful icon */
}

.toggle-switch input:checked + .ui-mode-slider:before {
    content: "üíº"; /* Professional icon */
}

/* Dark Mode Toggle */
.theme-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 600;
}

.theme-toggle-label {
    color: var(--text-secondary);
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 28px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.3s;
    border-radius: 34px;
    border: 2px solid var(--text-primary);
}

.toggle-slider:before {
    position: absolute;
    content: "‚òÄÔ∏è";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 2px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.toggle-switch input:checked + .toggle-slider {
    background-color: var(--terminal-dark);
    border-color: var(--neon-cyan);
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(32px);
    content: "üåô";
}

.toggle-switch input:focus + .toggle-slider {
    box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.3);
}

.mobile-terminal-toggle {
    display: none;
    background: var(--terminal-dark);
    color: var(--terminal-green);
    border: 2px solid var(--terminal-green);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.2rem;
}

/* ============================
   Main Container
   ============================ */
.main-container {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 12px 400px;
    gap: 0;
    max-width: 1600px;
    width: 100%;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    position: relative;
}

/* Panel Resizer */
.panel-resizer {
    width: 12px;
    background: linear-gradient(90deg, #ff6b9d, #ff8fb3);
    cursor: col-resize;
    position: relative;
    transition: all 0.2s ease;
    border-radius: 6px;
    margin: 0 1rem;
    box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
}

.panel-resizer:hover,
.panel-resizer.resizing {
    background: linear-gradient(90deg, #ff4d7d, #ff6b9d);
    box-shadow: 0 0 30px rgba(255, 107, 157, 0.8);
    width: 16px;
}

.panel-resizer::before {
    content: '‚ãÆ‚ãÆ‚ãÆ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    pointer-events: none;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/* ============================
   Notes Section
   ============================ */
.notes-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Filter Bar */
.filter-bar {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 16px;
    border: 3px solid var(--text-primary);
    box-shadow: 4px 4px 0 var(--text-primary);
}

.filter-label {
    font-family: var(--font-display);
    font-weight: 600;
    font-size: 1.1rem;
}

.filter-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.filter-btn {
    font-family: var(--font-body);
    background: var(--bg-primary);
    border: 2px solid var(--text-primary);
    padding: 0.6rem 1.2rem;
    min-height: 44px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.filter-btn:hover {
    transform: scale(1.05);
    box-shadow: 2px 2px 0 var(--text-primary);
}

.filter-btn.active {
    background: var(--text-primary);
    color: white;
    font-weight: bold;
}

.filter-btn:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

.add-note-btn {
    margin-left: auto;
    font-family: var(--font-display);
    background: var(--accent);
    color: white;
    border: 3px solid var(--text-primary);
    padding: 0.6rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 3px 3px 0 var(--text-primary);
}

.add-note-btn:hover {
    transform: translate(-2px, -2px);
    box-shadow: 5px 5px 0 var(--text-primary);
}

.add-note-btn:active {
    transform: translate(1px, 1px);
    box-shadow: 2px 2px 0 var(--text-primary);
}

.add-note-btn:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

.export-session-btn {
    font-family: var(--font-display);
    background: #ffffff;
    color: var(--text-primary);
    border: 2px dashed var(--accent);
    padding: 0.5rem 1.1rem;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    box-shadow: 2px 2px 0 var(--text-primary);
    transition: all 0.2s ease;
}

.export-session-btn:hover {
    transform: translate(-1px, -1px);
    box-shadow: 3px 3px 0 var(--text-primary);
}

.export-session-btn:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

/* Bulk Selection Bar */
.bulk-bar {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.9rem;
    flex-wrap: wrap;
}

.bulk-select-all {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    cursor: pointer;
}

.bulk-select-all input {
    cursor: pointer;
}

.bulk-selection-count {
    opacity: 0.8;
    font-weight: 500;
}

.bulk-category-select {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(255,255,255,0.8);
    font-family: var(--font-body);
}

.bulk-apply-btn,
.bulk-clear-btn,
.bulk-delete-btn {
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.85rem;
    font-family: var(--font-display);
    font-weight: 600;
    transition: all 0.2s ease;
}

.bulk-apply-btn {
    background: var(--accent);
    color: #fff;
}

.bulk-apply-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px var(--shadow);
}

.bulk-delete-btn {
    background: #c62828;
    color: #fff;
}

.bulk-delete-btn:hover {
    background: #b71c1c;
    transform: translateY(-1px);
}

.bulk-clear-btn {
    background: transparent;
    border: 1px solid rgba(0,0,0,0.15);
    color: var(--text-primary);
}

.bulk-clear-btn:hover {
    background: rgba(0,0,0,0.05);
}

/* ============================
   View Container & Notes Grid
   ============================ */
.view-container {
    min-height: 400px;
}

.notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1.5rem;
    padding: 1rem 0;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.empty-state p {
    font-family: var(--font-display);
    font-size: 1.1rem;
}

/* ============================
   Sticky Notes
   ============================ */
.sticky-note {
    background: var(--note-yellow);
    border: none;
    border-radius: 4px;
    padding: 1.25rem;
    box-shadow: 3px 3px 8px var(--shadow);
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    position: relative;
    animation: noteAppear 0.4s ease-out;
    transform-origin: center center;
}

@keyframes noteAppear {
    from {
        opacity: 0;
        transform: scale(0.8) rotate(-5deg);
    }
    to {
        opacity: 1;
        transform: scale(1) rotate(0deg);
    }
}

.sticky-note:nth-child(odd) {
    transform: rotate(1deg);
}

.sticky-note:nth-child(even) {
    transform: rotate(-1deg);
}

.sticky-note:hover {
    transform: rotate(0deg) scale(1.05);
    box-shadow: 6px 6px 16px var(--shadow-strong);
    z-index: 10;
}

.sticky-note.category-general {
    background: var(--cat-general);
}

.sticky-note.category-work {
    background: var(--cat-work);
}

.sticky-note.category-personal {
    background: var(--cat-personal);
}

.sticky-note.category-ideas {
    background: var(--cat-ideas);
}

.sticky-note.selected {
    outline: 3px solid var(--accent);
    box-shadow: 0 0 0 2px rgba(0,0,0,0.1), 0 6px 10px var(--shadow);
}

/* Note Size Variants */
.sticky-note.size-small {
    min-height: 150px;
}

.sticky-note.size-medium {
    min-height: 200px;
}

.sticky-note.size-large {
    min-height: 280px;
    grid-column: span 2;
}

/* Small note title: max 2 lines with ellipsis */
.sticky-note.size-small .note-title {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
    max-height: 2.6em; /* 2 lines */
    word-break: break-word;
    width: 100%;
    white-space: normal;
}

/* Small note buttons: hide some by default, show on hover */
.sticky-note.size-small .size-btn,
.sticky-note.size-small .fullscreen-btn,
.sticky-note.size-small .edit-btn,
.sticky-note.size-small .delete-btn {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
}

.sticky-note.size-small:hover .size-btn,
.sticky-note.size-small:hover .fullscreen-btn,
.sticky-note.size-small:hover .edit-btn,
.sticky-note.size-small:hover .delete-btn,
.sticky-note.size-small:focus-within .size-btn,
.sticky-note.size-small:focus-within .fullscreen-btn,
.sticky-note.size-small:focus-within .edit-btn,
.sticky-note.size-small:focus-within .delete-btn {
    opacity: 1;
    pointer-events: auto;
}

/* On smaller screens, don't span 2 columns */
@media (max-width: 768px) {
    .sticky-note.size-large {
        grid-column: span 1;
        min-height: 250px;
    }
}

.note-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
    gap: 0.5rem;
}

.note-select-wrapper {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    flex: 1;
    min-width: 80px;
    overflow: hidden;
}

.note-select-checkbox {
    flex-shrink: 0;
    cursor: pointer;
}

.note-title {
    font-family: var(--font-display);
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.note-actions {
    display: flex;
    gap: 0.25rem;
    flex-shrink: 0;
    position: relative;
    align-items: center;
}

.note-btn {
    background: rgba(255, 255, 255, 0.7);
    border: 2px solid var(--text-primary);
    border-radius: 6px;
    min-width: 44px;
    min-height: 44px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    padding: 0.5rem;
}

.note-btn:hover {
    background: white;
    transform: scale(1.1);
}

.note-btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* All buttons always visible - no hover required */
.note-btn.secondary,
.note-btn.primary {
    opacity: 1;
    pointer-events: auto;
}

/* Menu button specific styles */
.note-btn.menu-btn {
    font-size: 1.2rem;
    font-weight: bold;
    line-height: 1;
}

/* Dropdown menu for secondary actions */
.note-menu-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border: 2px solid var(--text-primary);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 100;
    min-width: 150px;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-10px);
    transition: all 0.2s ease;
}

.note-menu-dropdown.active {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.note-menu-dropdown button {
    width: 100%;
    padding: 0.75rem 1rem;
    border: none;
    background: white;
    text-align: left;
    cursor: pointer;
    font-family: var(--font-body);
    font-size: 0.9rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background 0.15s ease;
}

.note-menu-dropdown button:hover {
    background: rgba(0, 0, 0, 0.05);
}

.note-menu-dropdown button:active {
    background: rgba(0, 0, 0, 0.1);
}

.note-menu-dropdown button .icon {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

/* Bold/Italic state styles - applies to both title and body */
.sticky-note.style-bold .note-title,
.sticky-note.style-bold .note-body {
    font-weight: 700;
}

.sticky-note.style-italic .note-title,
.sticky-note.style-italic .note-body {
    font-style: italic;
}

.sticky-note.style-bold-italic .note-title,
.sticky-note.style-bold-italic .note-body {
    font-weight: 700;
    font-style: italic;
}

/* List styles for note body */
.sticky-note.list-bullet .note-body {
    padding-left: 1.5rem;
}

.sticky-note.list-bullet .note-body::before {
    content: '';
}

.sticky-note.list-number .note-body {
    padding-left: 1.5rem;
}

.note-body {
    flex: 1;
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text-primary);
    white-space: pre-wrap;
    word-break: break-word;
    overflow: hidden;
}

/* List styles for note body content */
.note-body ul,
.note-body ol {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
    list-style-position: inside;
}

.note-body li {
    margin: 0.25rem 0;
    white-space: normal;
}

.note-footer {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px dashed rgba(0, 0, 0, 0.2);
    font-size: 0.75rem;
    color: var(--text-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.note-category-tag {
    font-family: var(--font-display);
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid var(--text-primary);
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

/* ============================
   Terminal Panel
   ============================ */
.terminal-panel {
    position: sticky;
    top: 100px;
    height: fit-content;
}

.terminal-monitor {
    perspective: 1000px;
}

.monitor-frame {
    background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
    border-radius: 20px;
    padding: 1.5rem;
    box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.4),
        inset 0 2px 10px rgba(255, 255, 255, 0.1);
    border: 3px solid #1a1a1a;
}

.monitor-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.monitor-logo {
    font-family: var(--font-terminal);
    color: var(--terminal-green);
    font-size: 1.2rem;
    text-shadow: 0 0 10px var(--terminal-glow);
}

.power-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: radial-gradient(circle, #444, #222);
    border: 3px solid #1a1a1a;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
        inset 0 2px 5px rgba(0, 0, 0, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.3);
}

.power-btn:hover {
    background: radial-gradient(circle, #555, #333);
}

.power-btn.on .power-icon {
    color: var(--terminal-green);
    text-shadow: 0 0 15px var(--terminal-glow);
}

.power-icon {
    font-size: 1.5rem;
    color: #666;
    transition: all 0.3s ease;
}

.power-btn:focus-visible {
    outline: 3px solid var(--terminal-green);
    outline-offset: 2px;
}

.monitor-screen {
    background: var(--terminal-dark);
    border-radius: 12px;
    padding: 1.5rem;
    min-height: 400px;
    max-height: 500px;
    overflow: hidden;
    border: 4px solid #1a1a1a;
    box-shadow:
        inset 0 0 50px rgba(0, 0, 0, 0.8),
        inset 0 0 100px rgba(0, 100, 0, 0.1);
    position: relative;
    display: flex;
    flex-direction: column;
}

.monitor-screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
        repeating-linear-gradient(
            0deg,
            rgba(0, 0, 0, 0.15) 0px,
            transparent 1px,
            transparent 2px,
            rgba(0, 0, 0, 0.15) 3px
        );
    pointer-events: none;
    z-index: 1;
}

.screen-inner {
    position: relative;
    z-index: 2;
    height: 100%;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.terminal-output {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    font-family: var(--font-terminal);
    font-size: 1.1rem;
    line-height: 1.6;
    color: var(--terminal-green);
    text-shadow: 0 0 5px var(--terminal-glow);
    padding-bottom: 1rem;
    min-height: 0;
}

.terminal-output::-webkit-scrollbar {
    width: 10px;
}

.terminal-output::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 5px;
}

.terminal-output::-webkit-scrollbar-thumb {
    background: var(--terminal-green);
    border-radius: 5px;
    box-shadow: 0 0 10px var(--terminal-glow);
}

.terminal-output::-webkit-scrollbar-thumb:hover {
    background: var(--terminal-amber);
    box-shadow: 0 0 15px var(--terminal-amber);
}

.terminal-line {
    margin-bottom: 0.5rem;
    animation: lineAppear 0.3s ease-out;
}

@keyframes lineAppear {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.terminal-off {
    color: #333;
    text-shadow: none;
}

.terminal-prompt {
    color: var(--terminal-amber);
    text-shadow: 0 0 5px rgba(255, 176, 0, 0.5);
}

.terminal-error {
    color: #ff4444;
    text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
}

.terminal-success {
    color: #44ff44;
    text-shadow: 0 0 5px rgba(68, 255, 68, 0.5);
}

.terminal-input-line {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    border-top: 1px solid rgba(51, 255, 51, 0.2);
    padding-top: 1rem;
}

.terminal-prompt-text {
    font-family: var(--font-terminal);
    color: var(--terminal-green);
    text-shadow: 0 0 5px var(--terminal-glow);
    font-size: 1.1rem;
    white-space: nowrap;
}

.terminal-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-family: var(--font-terminal);
    color: var(--terminal-green);
    font-size: 1.1rem;
    text-shadow: 0 0 5px var(--terminal-glow);
    caret-color: var(--terminal-green);
}

.terminal-input::selection {
    background: var(--terminal-green);
    color: var(--terminal-dark);
}

.monitor-stand {
    width: 100px;
    height: 20px;
    background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
    margin: 1rem auto 0;
    border-radius: 0 0 10px 10px;
    border: 2px solid #1a1a1a;
    border-top: none;
}

/* ============================
   Modal Styles
   ============================ */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
    backdrop-filter: blur(8px);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        backdrop-filter: blur(0);
    }
    to {
        opacity: 1;
        backdrop-filter: blur(8px);
    }
}

.modal-content {
    background: var(--bg-secondary);
    border-radius: 20px;
    border: 5px solid var(--accent);
    box-shadow:
        0 25px 80px rgba(0, 0, 0, 0.5),
        0 0 0 3px var(--text-primary),
        0 0 40px rgba(255, 107, 157, 0.6);
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalBounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
}

@keyframes modalBounceIn {
    0% {
        transform: scale(0.3) translateY(-100px) rotate(-5deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.05) translateY(0) rotate(2deg);
    }
    70% {
        transform: scale(0.95) rotate(-1deg);
    }
    100% {
        transform: scale(1) translateY(0) rotate(0);
        opacity: 1;
    }
}

.modal-content::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: linear-gradient(45deg, var(--accent), #ff8fb3, var(--accent));
    border-radius: 20px;
    z-index: -1;
    animation: rotateBorder 3s linear infinite;
    pointer-events: none;
}

@keyframes rotateBorder {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 3px solid var(--accent);
    background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 143, 179, 0.05));
    position: relative;
}

.modal-header::after {
    content: '‚úèÔ∏è';
    position: absolute;
    top: 0.5rem;
    right: 3rem;
    font-size: 2rem;
    animation: modalFloat 2s ease-in-out infinite;
    opacity: 0.3;
    pointer-events: none;
}

@keyframes modalFloat {
    0%, 100% {
        transform: translateY(0) rotate(0deg);
    }
    50% {
        transform: translateY(-10px) rotate(5deg);
    }
}

.modal-header h2 {
    font-family: var(--font-display);
    font-size: 1.8rem;
    color: var(--accent);
    text-shadow: 2px 2px 0 rgba(255, 107, 157, 0.2);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.modal-close {
    background: transparent;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    border-radius: 50%;
}

.modal-close:hover {
    background: var(--bg-primary);
    color: var(--text-primary);
    transform: rotate(90deg);
}

.modal-close:focus-visible {
    outline: 3px solid var(--accent);
}

/* Form Styles */
.note-form {
    padding: 1.5rem;
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-group label {
    font-family: var(--font-display);
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text-primary);
}

.form-group label::before {
    content: 'üìù';
    font-size: 1.2rem;
    margin-right: 0.5rem;
}

.form-input,
.form-textarea,
.form-select {
    width: 100%;
    padding: 0.75rem;
    border: 3px solid var(--text-primary);
    border-radius: 12px;
    font-family: var(--font-body);
    font-size: 1rem;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all 0.3s ease;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
    outline: none;
    border-color: var(--accent);
    background: var(--bg-secondary);
    box-shadow:
        0 0 0 4px rgba(255, 107, 157, 0.2),
        0 0 20px rgba(255, 107, 157, 0.3);
    transform: scale(1.01);
}

.form-textarea {
    resize: vertical;
    min-height: 150px;
    line-height: 1.6;
}

/* Rich text editor styles */
.rich-editor {
    min-height: 150px;
    overflow-y: auto;
    cursor: text;
}

.rich-editor:empty::before {
    content: 'Write your note here...';
    color: #999;
    pointer-events: none;
}

.rich-editor ul,
.rich-editor ol {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.rich-editor li {
    margin: 0.25rem 0;
}

/* Formatting toolbar */
.formatting-toolbar {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    background: var(--bg-secondary);
    border: 2px solid var(--text-primary);
    border-radius: 8px 8px 0 0;
    border-bottom: none;
}

.format-btn {
    min-width: 36px;
    min-height: 36px;
    padding: 0.5rem;
    border: 2px solid var(--text-primary);
    border-radius: 6px;
    background: var(--bg-primary);
    color: var(--text-primary);
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.format-btn:hover {
    background: var(--accent);
    color: white;
    transform: scale(1.05);
}

.format-btn:active,
.format-btn.active {
    background: var(--text-primary);
    color: var(--bg-primary);
}

.formatting-toolbar + .rich-editor {
    border-radius: 0 0 12px 12px;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 1.5rem;
}

.btn {
    font-family: var(--font-display);
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    border: 3px solid var(--text-primary);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.2s ease;
}

.btn-primary {
    background: var(--accent);
    color: white;
    box-shadow: 3px 3px 0 var(--text-primary);
}

.btn-primary:hover {
    transform: translate(-2px, -2px);
    box-shadow: 5px 5px 0 var(--text-primary);
}

.btn-primary:active {
    transform: translate(1px, 1px);
    box-shadow: 2px 2px 0 var(--text-primary);
}

.btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.btn-secondary:hover {
    background: var(--bg-primary);
    transform: translateY(-2px);
}

.btn:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

/* ============================
   Footer Styles
   ============================ */
.footer {
    background: var(--bg-secondary);
    border-top: 3px solid var(--text-primary);
    padding: 1.5rem;
    text-align: center;
    margin-top: 2rem;
}

.footer p {
    font-family: var(--font-display);
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ============================
   Dark Mode Overrides
   ============================ */
body.dark-mode .header {
    background: var(--bg-secondary);
    border-bottom-color: var(--neon-cyan);
    box-shadow: 0 4px 20px rgba(0, 255, 249, 0.3);
}

body.dark-mode .logo {
    color: var(--neon-cyan);
    text-shadow: 0 0 10px rgba(0, 255, 249, 0.5);
}

body.dark-mode .nav-tab {
    color: var(--text-secondary);
}

body.dark-mode .nav-tab:hover {
    background: rgba(0, 255, 249, 0.1);
    color: var(--neon-cyan);
}

body.dark-mode .nav-tab.active {
    background: var(--neon-cyan);
    color: #0d1b1e;
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 249, 0.5);
}

body.dark-mode .theme-toggle-label {
    color: var(--neon-cyan);
}

body.dark-mode .toggle-slider {
    box-shadow: 0 0 10px rgba(0, 255, 249, 0.3);
}

body.dark-mode .filter-bar {
    background: var(--bg-secondary);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 249, 0.2);
}

body.dark-mode .filter-btn {
    background: var(--bg-primary);
    border-color: rgba(0, 255, 249, 0.5);
    color: var(--text-primary);
}

body.dark-mode .filter-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 10px rgba(0, 255, 249, 0.3);
}

body.dark-mode .filter-btn.active {
    background: var(--neon-cyan);
    color: #0d1b1e;
    border-color: var(--neon-cyan);
}

body.dark-mode .add-note-btn {
    background: var(--neon-pink);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(255, 42, 109, 0.4);
}

body.dark-mode .add-note-btn:hover {
    box-shadow: 0 0 30px rgba(255, 42, 109, 0.6);
}

body.dark-mode .export-session-btn {
    background: var(--bg-secondary);
    color: var(--neon-cyan);
    border-color: var(--neon-cyan);
    box-shadow: 0 0 10px rgba(0, 255, 249, 0.2);
}

body.dark-mode .export-session-btn:hover {
    box-shadow: 0 0 20px rgba(0, 255, 249, 0.4);
}

body.dark-mode .sticky-note {
    border: 2px solid rgba(0, 255, 249, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    color: var(--text-primary);
}

body.dark-mode .sticky-note:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 25px rgba(0, 255, 249, 0.4);
}

body.dark-mode .note-btn {
    background: rgba(0, 255, 249, 0.1);
    border-color: rgba(0, 255, 249, 0.5);
    color: var(--neon-cyan);
}

body.dark-mode .note-btn:hover {
    background: rgba(0, 255, 249, 0.2);
    border-color: var(--neon-cyan);
}

body.dark-mode .note-menu-dropdown {
    background: var(--bg-secondary);
    border-color: rgba(0, 255, 249, 0.5);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6), 0 0 15px rgba(0, 255, 249, 0.2);
}

body.dark-mode .note-menu-dropdown button {
    background: var(--bg-secondary);
    color: var(--neon-cyan);
}

body.dark-mode .note-menu-dropdown button:hover {
    background: rgba(0, 255, 249, 0.1);
}

body.dark-mode .note-menu-dropdown button:active {
    background: rgba(0, 255, 249, 0.2);
}

body.dark-mode .note-category-tag {
    background: rgba(0, 255, 249, 0.1);
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

body.dark-mode .modal-content {
    background: var(--bg-secondary);
    border-color: var(--neon-cyan);
    box-shadow:
        0 25px 80px rgba(0, 0, 0, 0.9),
        0 0 0 3px rgba(0, 255, 249, 0.5),
        0 0 60px rgba(0, 255, 249, 0.3);
}

body.dark-mode .modal-header {
    border-bottom-color: var(--neon-cyan);
    background: linear-gradient(135deg, rgba(0, 255, 249, 0.1), rgba(0, 255, 249, 0.05));
}

body.dark-mode .modal-header h2 {
    color: var(--neon-cyan);
    text-shadow: 0 0 10px rgba(0, 255, 249, 0.5);
}

body.dark-mode .form-input,
body.dark-mode .form-textarea,
body.dark-mode .form-select {
    background: var(--bg-primary);
    border-color: rgba(0, 255, 249, 0.5);
    color: var(--text-primary);
}

body.dark-mode .form-input:focus,
body.dark-mode .form-textarea:focus,
body.dark-mode .form-select:focus {
    border-color: var(--neon-cyan);
    background: var(--bg-secondary);
    box-shadow: 0 0 20px rgba(0, 255, 249, 0.3);
}

body.dark-mode .btn-primary {
    background: var(--neon-cyan);
    color: #0d1b1e;
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0, 255, 249, 0.4);
}

body.dark-mode .btn-primary:hover {
    box-shadow: 0 0 30px rgba(0, 255, 249, 0.6);
}

body.dark-mode .btn-primary:active {
    transform: translate(1px, 1px);
    box-shadow: 0 0 15px rgba(0, 255, 249, 0.4);
}

body.dark-mode .btn-secondary {
    background: var(--bg-primary);
    color: var(--text-primary);
    border-color: rgba(0, 255, 249, 0.5);
}

body.dark-mode .btn-secondary:hover {
    border-color: var(--neon-cyan);
}

body.dark-mode .footer {
    background: var(--bg-secondary);
    border-top-color: var(--neon-cyan);
}

body.dark-mode .panel-resizer {
    background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink));
    box-shadow: 0 0 30px rgba(0, 255, 249, 0.6);
}

body.dark-mode .panel-resizer:hover {
    box-shadow: 0 0 40px rgba(0, 255, 249, 0.8);
}

body.dark-mode .empty-state {
    color: var(--text-secondary);
}

body.dark-mode .bulk-category-select {
    background: var(--bg-primary);
    color: var(--text-primary);
    border-color: rgba(0, 255, 249, 0.5);
}

body.dark-mode .bulk-apply-btn {
    background: var(--neon-cyan);
    color: #0d1b1e;
}

body.dark-mode .bulk-delete-btn {
    background: var(--neon-pink);
}

body.dark-mode .bulk-clear-btn {
    background: var(--bg-primary);
    border-color: rgba(0, 255, 249, 0.5);
    color: var(--text-primary);
}

/* ============================
   Fullscreen Note Overlay
   ============================ */
.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    animation: fadeIn 0.3s ease;
}

.fullscreen-note {
    background: var(--bg-secondary);
    border-radius: 20px;
    border: 4px solid var(--accent);
    box-shadow: 0 30px 100px rgba(0, 0, 0, 0.8);
    max-width: 1200px;
    width: 100%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    animation: modalBounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.fullscreen-note.category-general {
    background: var(--cat-general);
}

.fullscreen-note.category-work {
    background: var(--cat-work);
}

.fullscreen-note.category-personal {
    background: var(--cat-personal);
}

.fullscreen-note.category-ideas {
    background: var(--cat-ideas);
}

.fullscreen-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem;
    border-bottom: 3px solid var(--text-primary);
    background: rgba(255, 255, 255, 0.5);
}

.fullscreen-title-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

.fullscreen-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.fullscreen-category-tag {
    font-family: var(--font-display);
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--text-primary);
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
}

.fullscreen-actions {
    display: flex;
    gap: 0.5rem;
}

.fullscreen-action-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--text-primary);
    border-radius: 10px;
    width: 50px;
    height: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.fullscreen-action-btn:hover {
    background: white;
    transform: scale(1.1);
}

.fullscreen-action-btn.close-fullscreen {
    background: var(--accent);
    color: white;
    font-size: 2rem;
    font-weight: bold;
}

.fullscreen-body {
    flex: 1;
    padding: 2.5rem;
    font-size: 1.2rem;
    line-height: 1.8;
    color: var(--text-primary);
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-word;
}

.fullscreen-footer {
    padding: 1.5rem 2rem;
    border-top: 2px dashed var(--text-primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.95rem;
    color: var(--text-secondary);
    background: rgba(255, 255, 255, 0.3);
}

/* Dark Mode Fullscreen Note */
body.dark-mode .fullscreen-note {
    background: var(--bg-secondary);
    border-color: var(--neon-cyan);
    box-shadow: 0 30px 100px rgba(0, 0, 0, 1), 0 0 60px rgba(0, 255, 249, 0.4);
}

body.dark-mode .fullscreen-note.category-general,
body.dark-mode .fullscreen-note.category-work,
body.dark-mode .fullscreen-note.category-personal,
body.dark-mode .fullscreen-note.category-ideas {
    background: var(--bg-secondary);
}

body.dark-mode .fullscreen-header {
    background: rgba(0, 255, 249, 0.05);
    border-bottom-color: var(--neon-cyan);
}

body.dark-mode .fullscreen-title {
    color: var(--neon-cyan);
    text-shadow: 0 0 20px rgba(0, 255, 249, 0.5);
}

body.dark-mode .fullscreen-category-tag {
    background: rgba(0, 255, 249, 0.1);
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

body.dark-mode .fullscreen-action-btn {
    background: rgba(0, 255, 249, 0.1);
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

body.dark-mode .fullscreen-action-btn:hover {
    background: rgba(0, 255, 249, 0.2);
}

body.dark-mode .fullscreen-action-btn.close-fullscreen {
    background: var(--neon-pink);
    color: white;
}

body.dark-mode .fullscreen-footer {
    background: rgba(0, 255, 249, 0.05);
    border-top-color: rgba(0, 255, 249, 0.3);
}

/* ============================
   Terminal Fullscreen Mode
   ============================ */
.terminal-fullscreen-btn {
    width: 35px;
    height: 35px;
    border-radius: 8px;
    background: rgba(51, 255, 51, 0.1);
    border: 2px solid var(--terminal-green);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    margin-right: 0.5rem;
}

.terminal-fullscreen-btn:hover {
    background: rgba(51, 255, 51, 0.2);
    transform: scale(1.05);
}

.fullscreen-icon {
    font-size: 1.2rem;
    color: var(--terminal-green);
    text-shadow: 0 0 10px var(--terminal-glow);
}

.monitor-controls {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

body.terminal-fullscreen .terminal-panel {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100% !important;
    height: 100% !important;
    z-index: 1500;
    background: var(--terminal-dark);
    padding: 2rem;
    overflow-y: auto;
}

body.terminal-fullscreen .monitor-frame {
    height: 100%;
    display: flex;
    flex-direction: column;
}

body.terminal-fullscreen .monitor-screen {
    flex: 1;
    max-height: none;
    min-height: 0;
    overflow: auto !important;
}

body.terminal-fullscreen .monitor-stand {
    display: none;
}

body.terminal-fullscreen .notes-section,
body.terminal-fullscreen .filter-bar,
body.terminal-fullscreen .panel-resizer,
body.terminal-fullscreen .header,
body.terminal-fullscreen .footer {
    display: none !important;
}

body.terminal-fullscreen .main-container {
    padding: 0;
    grid-template-columns: 1fr;
}

/* Dark Mode Terminal Controls */
body.dark-mode .terminal-fullscreen-btn {
    background: rgba(0, 255, 249, 0.1);
    border-color: var(--neon-cyan);
}

body.dark-mode .terminal-fullscreen-btn:hover {
    background: rgba(0, 255, 249, 0.2);
}

body.dark-mode .fullscreen-icon {
    color: var(--neon-cyan);
    text-shadow: 0 0 10px rgba(0, 255, 249, 0.5);
}

/* ============================
   Responsive Design
   ============================ */
@media (max-width: 1024px) {
    .main-container {
        grid-template-columns: 1fr;
    }

    .panel-resizer {
        display: none;
    }

    .terminal-panel {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        z-index: 200;
        background: rgba(0, 0, 0, 0.95);
        padding: 1rem;
        max-height: 70vh;
        overflow-y: auto;
    }

    .terminal-panel.mobile-open {
        display: block;
        animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }

    .mobile-terminal-toggle {
        display: block;
    }

    .monitor-frame {
        margin-bottom: 0;
    }

    .monitor-stand {
        display: none;
    }
}

@media (max-width: 768px) {
    .header-content {
        padding: 0.75rem 1rem;
    }

    .logo {
        font-size: 1.2rem;
    }

    .logo-icon {
        font-size: 1.5rem;
    }

    .nav-tab {
        padding: 0.4rem 0.75rem;
        font-size: 0.9rem;
    }

    .main-container {
        padding: 1rem;
    }

    .filter-bar {
        padding: 0.75rem;
    }

    .add-note-btn,
    .export-session-btn {
        width: 100%;
        justify-content: center;
        margin-left: 0;
    }

    .notes-grid {
        grid-template-columns: 1fr;
    }

    .modal-content {
        width: 95%;
        max-height: 85vh;
    }

    .theme-toggle {
        margin-left: 0;
    }

    /* Show all buttons on mobile/tablet (no hover) */
    .note-btn.secondary {
        opacity: 1;
        pointer-events: auto;
        max-width: 44px;
        min-width: 44px;
        padding: 0.5rem;
        border: 2px solid var(--text-primary);
    }
}

@media (max-width: 480px) {
    .filter-buttons {
        width: 100%;
    }

    .filter-btn {
        flex: 1;
        min-width: 70px;
        text-align: center;
    }

    .nav-tabs {
        flex: 1;
    }

    .nav-tab {
        flex: 1;
        justify-content: center;
    }

    .header-content {
        gap: 0.5rem;
    }
}

/* ============================
   Accessibility & Motion
   ============================ */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

*:focus-visible {
    outline: 3px solid var(--accent);
    outline-offset: 2px;
}

/* ============================
   Shake Animation for Modal
   ============================ */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}


/* Universal back button */
#backToHome{
  position:fixed; right:16px; top:16px;
  padding:10px 16px;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  color: #ffffff;
  font: 600 13px/1 system-ui, sans-serif;
  z-index:9999;
  cursor:pointer;
  transition:all .15s ease;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:6px;
}
#backToHome:hover{
  background: rgba(255,255,255,0.15);
  border-color: rgba(255,255,255,0.4);
  transform:translateY(-1px);
}
#backToHome:active{transform:scale(0.97);}
@media (max-width:640px){
  #backToHome{padding:8px 12px; font-size:12px; right:12px; top:12px;}
}
</style>
</head>
<body>
<a id="backToHome" href="index.html" title="Back to Homepage">
  <span>‚Üê</span>
  <span>Home</span>
</a>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon" aria-hidden="true">üìù</span>
                <h1 class="logo-text">NoteCenter OS</h1>
            </div>

            <nav class="nav-tabs" role="navigation" aria-label="Main navigation">
                <button class="nav-tab active" data-view="board" aria-label="Switch to Board view" aria-pressed="true">
                    <span class="tab-icon" aria-hidden="true">üìã</span>
                    <span>Board</span>
                </button>
                <button class="nav-tab" data-view="dashboard" aria-label="Switch to Dashboard view" aria-pressed="false">
                    <span class="tab-icon" aria-hidden="true">‚≠ê</span>
                    <span>Dashboard</span>
                </button>
            </nav>

            <div class="ui-mode-toggle">
                <span class="ui-mode-toggle-label">UI Mode</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="uiModeToggle" aria-label="Toggle UI mode">
                    <span class="toggle-slider ui-mode-slider"></span>
                </label>
            </div>

            <div class="theme-toggle">
                <span class="theme-toggle-label">Dark Mode</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" aria-label="Toggle dark mode">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <button class="mobile-terminal-toggle" aria-label="Toggle terminal">
                <span class="terminal-icon" aria-hidden="true">üíª</span>
            </button>

            <div style="margin-left:auto;">
                <a href="index.html" style="display:inline-flex;align-items:center;gap:6px;color:#5cffc6;text-decoration:none;font-size:12px;font-weight:700;padding:6px 12px;border-radius:10px;border:1px solid rgba(92,255,198,.35);background:rgba(92,255,198,.08);transition:all .12s ease;" onmouseover="this.style.background='rgba(92,255,198,.15)'" onmouseout="this.style.background='rgba(92,255,198,.08)'">‚Üê Back</a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Notes Section -->
        <section class="notes-section" aria-label="Notes area" id="notesSection">
            <!-- Category Filter -->
            <div class="filter-bar" role="region" aria-label="Note filters">
                <label class="filter-label" id="filter-label">Filter:</label>
                <div class="filter-buttons" role="group" aria-labelledby="filter-label">
                    <button class="filter-btn active" data-category="all">All</button>
                    <button class="filter-btn" data-category="general">General</button>
                    <button class="filter-btn" data-category="work">Work</button>
                    <button class="filter-btn" data-category="personal">Personal</button>
                    <button class="filter-btn" data-category="ideas">Ideas</button>
                </div>
                <button class="add-note-btn" aria-label="Add new note">
                    <span class="btn-icon" aria-hidden="true">‚ûï</span>
                    <span>New Note</span>
                </button>
                <button class="export-session-btn" id="exportSessionBtn" aria-label="Export notes">
                    <span class="btn-icon" aria-hidden="true">üíæ</span>
                    <span>Export</span>
                </button>
            </div>

            <!-- Bulk Selection Bar -->
            <div class="bulk-bar" id="bulkBar" role="region" aria-label="Bulk actions">
                <label class="bulk-select-all">
                    <input type="checkbox" id="selectAllNotes" aria-label="Select all notes">
                    <span>Select all in view</span>
                </label>
                <span class="bulk-selection-count" id="bulkSelectionCount" aria-live="polite">0 selected</span>
                <label for="bulkCategorySelect" class="sr-only">Set category for selected notes</label>
                <select id="bulkCategorySelect" class="bulk-category-select" aria-label="Category for selected notes">
                    <option value="">Set category‚Ä¶</option>
                    <option value="general">General</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="ideas">Ideas</option>
                </select>
                <button id="applyBulkCategoryBtn" class="bulk-apply-btn">Apply</button>
                <button id="bulkDeleteBtn" class="bulk-delete-btn">Delete</button>
                <button id="clearSelectionBtn" class="bulk-clear-btn">Clear</button>
            </div>

            <!-- Board View -->
            <div class="view-container" id="boardView">
                <div class="notes-grid" id="notesGrid" role="list" aria-label="Sticky notes">
                    <!-- Notes will be injected here -->
                </div>
                <div class="empty-state" id="boardEmptyState">
                    <div class="empty-icon" aria-hidden="true">üìù</div>
                    <p>No notes yet! Create your first sticky note.</p>
                </div>
            </div>

            <!-- Dashboard View -->
            <div class="view-container" id="dashboardView" style="display: none;">
                <div class="notes-grid" id="dashboardGrid" role="list" aria-label="Pinned notes">
                    <!-- Pinned notes will be injected here -->
                </div>
                <div class="empty-state" id="dashboardEmptyState" style="display: none;">
                    <div class="empty-icon" aria-hidden="true">‚≠ê</div>
                    <p>No pinned notes yet! Pin some notes to see them here.</p>
                </div>
            </div>

            <!-- Boss Mode Screen -->
            <div class="boss-screen" aria-live="polite">
                <div>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó</div>
                <div>‚ïë   SYSTEM STATUS MONITOR v2.1.4        ‚ïë</div>
                <div>‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</div>
                <div>&nbsp;</div>
                <div>All systems nominal</div>
                <div>Network: CONNECTED</div>
                <div>CPU Usage: 23%</div>
                <div>Memory: 4.2 GB / 16 GB</div>
                <div>Disk: 234 GB / 512 GB</div>
                <div>&nbsp;</div>
                <div>Last backup: 2 hours ago</div>
                <div>Security status: SECURE</div>
                <div>&nbsp;</div>
                <div style="color: #ffb000; font-weight: bold;">‚ö† TO EXIT BOSS MODE:</div>
                <div>‚Ä¢ Type /panic in terminal, OR</div>
                <div>‚Ä¢ Press ESC key</div>
            </div>
        </section>

        <!-- Resizer -->
        <div class="panel-resizer" id="panelResizer" role="separator" aria-label="Resize panels"></div>

        <!-- Terminal Panel -->
        <aside class="terminal-panel" aria-label="Terminal panel" id="terminalPanel">
            <div class="terminal-monitor">
                <div class="monitor-frame">
                    <div class="monitor-top">
                        <div class="monitor-logo">NoteCenter Terminal</div>
                        <div class="monitor-controls">
                            <button class="terminal-fullscreen-btn" aria-label="Toggle terminal fullscreen" title="Fullscreen">
                                <span class="fullscreen-icon" aria-hidden="true">‚õ∂</span>
                            </button>
                            <button class="power-btn" aria-label="Power on/off terminal">
                                <span class="power-icon" aria-hidden="true">‚èª</span>
                            </button>
                        </div>
                    </div>
                    <div class="monitor-screen">
                        <div class="screen-inner" id="terminalScreen">
                            <div class="terminal-output" id="terminal-output" role="log" aria-live="polite" aria-atomic="false">
                                <div class="terminal-line terminal-off">System offline. Press power button to boot.</div>
                            </div>
                            <div class="terminal-input-line" id="terminalInputLine" style="display: none;">
                                <label for="terminal-input" class="sr-only">Terminal command input</label>
                                <span class="terminal-prompt-text" aria-hidden="true">guest@notecenter:~$</span>
                                <input
                                    type="text"
                                    class="terminal-input"
                                    id="terminal-input"
                                    autocomplete="off"
                                    spellcheck="false"
                                    aria-label="Terminal command input"
                                >
                            </div>
                        </div>
                    </div>
                    <div class="monitor-stand" aria-hidden="true"></div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <p>&copy; 2025 NoteCenter OS &middot; v1.0.0</p>
    </footer>

    <!-- Note Modal -->
    <div class="modal-overlay" id="noteModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">New Note</h2>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <form id="noteForm" class="note-form">
                <div class="form-group">
                    <label for="noteTitle">Title</label>
                    <input
                        type="text"
                        id="noteTitle"
                        class="form-input"
                        required
                        maxlength="50"
                        aria-required="true"
                    >
                </div>
                <div class="form-group">
                    <label for="noteBody">Note</label>
                    <div class="formatting-toolbar">
                        <button type="button" class="format-btn" data-command="bold" title="Bold (Ctrl+B)">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="format-btn" data-command="italic" title="Italic (Ctrl+I)">
                            <em>I</em>
                        </button>
                        <button type="button" class="format-btn" data-command="insertUnorderedList" title="Bullet List">
                            ‚Ä¢
                        </button>
                        <button type="button" class="format-btn" data-command="insertOrderedList" title="Numbered List">
                            1.
                        </button>
                    </div>
                    <div
                        id="noteBody"
                        class="form-textarea rich-editor"
                        contenteditable="true"
                        role="textbox"
                        aria-required="true"
                        aria-multiline="true"
                    ></div>
                </div>
                <div class="form-group">
                    <label for="noteCategory">Category</label>
                    <select id="noteCategory" class="form-select">
                        <option value="general">General</option>
                        <option value="work">Work</option>
                        <option value="personal">Personal</option>
                        <option value="ideas">Ideas</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Note</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
// ============================
// NoteCenter OS - JavaScript
// A playful sticky-note + terminal web app
// ============================

'use strict';

// ============================
// Application State
// ============================
const APP_STATE = {
    notes: [],
    currentView: 'board',
    currentFilter: 'all',
    editingNoteId: null,
    terminalPowered: false,
    bootSequenceShown: false,
    sessionStart: Date.now(),
    selectedNoteIds: new Set(),
    lastAction: null,
    quickNoteCounter: 1,
    darkMode: false,
    uiMode: 'professional', // 'professional' or 'playful'
    fullscreenNoteId: null,
    terminalFullscreen: false,
    appName: 'NoteCenter OS',
    hostUser: 'guest'
};

const STORAGE_KEY = 'noteCenterOS.notes';
const DARK_MODE_KEY = 'noteCenterOS.darkMode';
const UI_MODE_KEY = 'noteCenterOS.uiMode';
const OS_NAME_KEY = 'noteCenterOS.appName';
const HOST_USER_KEY = 'noteCenterOS.hostUser';

// ============================
// DOM Elements Cache
// ============================
let DOM = {};

function cacheDOM() {
    DOM = {
        // Navigation
        navTabs: document.querySelectorAll('.nav-tab'),

        // Views
        boardView: document.getElementById('boardView'),
        dashboardView: document.getElementById('dashboardView'),
        notesGrid: document.getElementById('notesGrid'),
        dashboardGrid: document.getElementById('dashboardGrid'),
        boardEmptyState: document.getElementById('boardEmptyState'),
        dashboardEmptyState: document.getElementById('dashboardEmptyState'),

        // Filters
        filterButtons: document.querySelectorAll('.filter-btn'),
        addNoteBtn: document.querySelector('.add-note-btn'),
        exportSessionBtn: document.getElementById('exportSessionBtn'),

        // Modal
        modal: document.getElementById('noteModal'),
        modalTitle: document.getElementById('modalTitle'),
        noteForm: document.getElementById('noteForm'),
        noteTitle: document.getElementById('noteTitle'),
        noteBody: document.getElementById('noteBody'),
        noteCategory: document.getElementById('noteCategory'),
        modalClose: document.querySelector('.modal-close'),
        cancelBtn: document.getElementById('cancelBtn'),

        // Terminal
        terminalPanel: document.querySelector('.terminal-panel'),
        powerBtn: document.querySelector('.power-btn'),
        terminalOutput: document.getElementById('terminal-output'),
        terminalInput: document.getElementById('terminal-input'),
        terminalInputLine: document.getElementById('terminalInputLine'),
        terminalPromptText: document.querySelector('.terminal-prompt-text'),
        mobileTerminalToggle: document.querySelector('.mobile-terminal-toggle'),

        // Panel Resizer
        panelResizer: document.getElementById('panelResizer'),
        notesSection: document.getElementById('notesSection'),
        mainContainer: document.querySelector('.main-container'),

        // Bulk Actions
        bulkBar: document.getElementById('bulkBar'),
        bulkCategorySelect: document.getElementById('bulkCategorySelect'),
        applyBulkCategoryBtn: document.getElementById('applyBulkCategoryBtn'),
        bulkDeleteBtn: document.getElementById('bulkDeleteBtn'),
        clearSelectionBtn: document.getElementById('clearSelectionBtn'),
        selectAllNotes: document.getElementById('selectAllNotes'),
        bulkSelectionCount: document.getElementById('bulkSelectionCount'),

        // Dark Mode
        darkModeToggle: document.getElementById('darkModeToggle'),

        // UI Mode
        uiModeToggle: document.getElementById('uiModeToggle'),

        // Branding
        logoText: document.querySelector('.logo-text'),
        footerText: document.querySelector('.footer p')
    };
}

// ============================
// Initialization
// ============================
function init() {
    cacheDOM();
    loadNotes();
    initUIMode();
    initDarkMode();
    initBranding();
    renderNotes();
    attachEventListeners();
    initPanelResizer();
    NoteCenterTerminal.init();
}

// ============================
// Dark Mode Management
// ============================
function initDarkMode() {
    // Check for saved preference
    const savedDarkMode = localStorage.getItem(DARK_MODE_KEY);

    if (savedDarkMode !== null) {
        // Use saved preference
        APP_STATE.darkMode = savedDarkMode === 'true';
    } else {
        // Check system preference
        APP_STATE.darkMode = window.matchMedia &&
                             window.matchMedia('(prefers-color-scheme: dark)').matches;
    }

    // Apply dark mode
    if (APP_STATE.darkMode) {
        document.body.classList.add('dark-mode');
    }

    // Update checkbox state to match
    if (DOM.darkModeToggle) {
        DOM.darkModeToggle.checked = APP_STATE.darkMode;
    }
}

function toggleDarkMode() {
    APP_STATE.darkMode = !APP_STATE.darkMode;
    document.body.classList.toggle('dark-mode');

    // Update checkbox state
    if (DOM.darkModeToggle) {
        DOM.darkModeToggle.checked = APP_STATE.darkMode;
    }

    // Save preference
    try {
        localStorage.setItem(DARK_MODE_KEY, APP_STATE.darkMode);
    } catch (err) {
        console.error('Unable to save dark mode preference:', err);
    }

    // Terminal notification
    if (APP_STATE.terminalPowered) {
        const mode = APP_STATE.darkMode ? 'dark' : 'light';
        if (typeof NoteCenterTerminal !== 'undefined' && NoteCenterTerminal.printSuccess) {
            NoteCenterTerminal.printSuccess(`Switched to ${mode} mode.`);
        }
    }
}

// ============================
// UI Mode Management
// ============================
function initUIMode() {
    // Check for saved preference, default to professional
    const savedUIMode = localStorage.getItem(UI_MODE_KEY);

    if (savedUIMode !== null) {
        // Use saved preference
        APP_STATE.uiMode = savedUIMode;
    } else {
        // Default to professional mode
        APP_STATE.uiMode = 'professional';
    }

    // Apply UI mode
    if (APP_STATE.uiMode === 'professional') {
        document.body.classList.add('mode-professional');
    }

    // Update checkbox state to match
    if (DOM.uiModeToggle) {
        DOM.uiModeToggle.checked = APP_STATE.uiMode === 'professional';
    }

    // Save default if not already saved
    try {
        localStorage.setItem(UI_MODE_KEY, APP_STATE.uiMode);
    } catch (err) {
        console.error('Unable to save UI mode preference:', err);
    }
}

function toggleUIMode() {
    // Toggle between professional and playful
    APP_STATE.uiMode = APP_STATE.uiMode === 'professional' ? 'playful' : 'professional';

    // Update body class
    if (APP_STATE.uiMode === 'professional') {
        document.body.classList.add('mode-professional');
    } else {
        document.body.classList.remove('mode-professional');
    }

    // Update checkbox state
    if (DOM.uiModeToggle) {
        DOM.uiModeToggle.checked = APP_STATE.uiMode === 'professional';
    }

    // Save preference
    try {
        localStorage.setItem(UI_MODE_KEY, APP_STATE.uiMode);
    } catch (err) {
        console.error('Unable to save UI mode preference:', err);
    }

    // Terminal notification
    if (APP_STATE.terminalPowered) {
        const mode = APP_STATE.uiMode === 'professional' ? 'Professional' : 'Playful';
        if (typeof NoteCenterTerminal !== 'undefined' && NoteCenterTerminal.printSuccess) {
            NoteCenterTerminal.printSuccess(`Switched to ${mode} UI mode.`);
        }
    }
}

function getTerminalPrompt() {
    const userRaw = APP_STATE.hostUser || 'guest';
    const appRaw = APP_STATE.appName || 'NoteCenter OS';
    const user = String(userRaw).trim() || 'guest';
    const app = String(appRaw).trim() || 'NoteCenter OS';
    return `${user}@${app}:~$`;
}

function refreshTerminalPromptDisplay() {
    if (DOM.terminalPromptText) {
        DOM.terminalPromptText.textContent = getTerminalPrompt();
    }
}

function setAppName(name) {
    if (!name) return;
    const trimmed = String(name).trim();
    if (!trimmed) return;

    APP_STATE.appName = trimmed;

    if (DOM.logoText) {
        DOM.logoText.textContent = trimmed;
    }

    if (DOM.footerText) {
        const year = new Date().getFullYear();
        DOM.footerText.textContent = `¬© ${year} ${trimmed} ¬∑ v1.0.0`;
    }

    try {
        document.title = trimmed;
    } catch (err) {
        console.error('Unable to set document title:', err);
    }

    try {
        localStorage.setItem(OS_NAME_KEY, trimmed);
    } catch (err) {
        console.error('Unable to save OS name:', err);
    }

    refreshTerminalPromptDisplay();
}

function setHostUser(name) {
    if (!name) return;
    const trimmed = String(name).trim();
    if (!trimmed) return;

    APP_STATE.hostUser = trimmed;

    try {
        localStorage.setItem(HOST_USER_KEY, trimmed);
    } catch (err) {
        console.error('Unable to save host user:', err);
    }

    refreshTerminalPromptDisplay();
}

function initBranding() {
    // Load OS name
    let storedName = null;
    try {
        storedName = localStorage.getItem(OS_NAME_KEY);
    } catch (err) {
        console.error('Error loading OS name:', err);
    }

    let currentName = 'NoteCenter OS';
    if (storedName && storedName.trim()) {
        currentName = storedName.trim();
    } else if (DOM.logoText && DOM.logoText.textContent.trim()) {
        currentName = DOM.logoText.textContent.trim();
    }
    APP_STATE.appName = currentName;
    try {
        localStorage.setItem(OS_NAME_KEY, currentName);
    } catch (err) {
        console.error('Error saving default OS name:', err);
    }
    // Apply to UI and prompt
    setAppName(currentName);

    // Load host user
    let storedUser = null;
    try {
        storedUser = localStorage.getItem(HOST_USER_KEY);
    } catch (err) {
        console.error('Error loading host user:', err);
    }

    let user = 'guest';
    if (storedUser && storedUser.trim()) {
        user = storedUser.trim();
    }
    APP_STATE.hostUser = user;
    try {
        localStorage.setItem(HOST_USER_KEY, user);
    } catch (err) {
        console.error('Error saving default host user:', err);
    }

    refreshTerminalPromptDisplay();
}

// ============================
// Panel Resizer
// ============================
function initPanelResizer() {
    if (!DOM.panelResizer) return;

    let isResizing = false;
    let startX = 0;
    let startNotesWidth = 0;
    let startTerminalWidth = 0;

    DOM.panelResizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;

        const notesRect = DOM.notesSection.getBoundingClientRect();
        const terminalRect = DOM.terminalPanel.getBoundingClientRect();

        startNotesWidth = notesRect.width;
        startTerminalWidth = terminalRect.width;

        DOM.panelResizer.classList.add('resizing');
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';

        e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        const deltaX = e.clientX - startX;
        const newNotesWidth = startNotesWidth + deltaX;
        const newTerminalWidth = startTerminalWidth - deltaX;

        if (newNotesWidth >= 300 && newTerminalWidth >= 300) {
            DOM.mainContainer.style.gridTemplateColumns = `${newNotesWidth}px 12px ${newTerminalWidth}px`;
        }
    });

    document.addEventListener('mouseup', () => {
        if (!isResizing) return;
        isResizing = false;
        DOM.panelResizer.classList.remove('resizing');
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
    });
}

// ============================
// Local Storage
// ============================
function loadNotes() {
    try {
        const stored = localStorage.getItem(STORAGE_KEY);
        APP_STATE.notes = stored ? JSON.parse(stored) : [];
    } catch (err) {
        console.error('Error loading notes:', err);
        APP_STATE.notes = [];
    }
}

function saveNotes() {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(APP_STATE.notes));
    } catch (err) {
        console.error('Error saving notes:', err);
    }
}

// ============================
// Note Management (CRUD)
// ============================
function createNote(title, body, category = 'general', bodyHtml = null) {
    const note = {
        id: generateId(),
        title: title.trim(),
        body: body.trim(),
        bodyHtml: bodyHtml ? bodyHtml.trim() : null, // Store HTML for rich text
        category,
        pinned: false,
        size: 'medium', // small, medium, large
        createdAt: Date.now(),
        updatedAt: Date.now()
    };

    APP_STATE.notes.unshift(note);
    APP_STATE.lastAction = {
        type: 'create',
        noteId: note.id
    };
    saveNotes();
    renderNotes();
    return note;
}

function updateNote(id, title, body, category, bodyHtml = null) {
    const note = APP_STATE.notes.find(n => n.id === id);
    if (!note) return null;

    note.title = title.trim();
    note.body = body.trim();
    note.bodyHtml = bodyHtml ? bodyHtml.trim() : null; // Store HTML for rich text
    note.category = category;
    note.updatedAt = Date.now();

    saveNotes();
    renderNotes();
    return note;
}

function deleteNote(id) {
    const idx = APP_STATE.notes.findIndex(n => n.id === id);
    if (idx === -1) return null;
    const [removed] = APP_STATE.notes.splice(idx, 1);

    APP_STATE.lastAction = {
        type: 'delete',
        note: removed,
        index: idx
    };

    saveNotes();
    renderNotes();
    return removed;
}

function togglePin(id) {
    const note = APP_STATE.notes.find(n => n.id === id);
    if (!note) return null;

    APP_STATE.lastAction = {
        type: 'pinToggle',
        id: note.id,
        wasPinned: note.pinned
    };

    note.pinned = !note.pinned;
    saveNotes();
    renderNotes();
    return note;
}

function getNoteById(id) {
    return APP_STATE.notes.find(n => n.id === id);
}

function searchNotes(keyword) {
    const k = keyword.toLowerCase();
    return APP_STATE.notes.filter(n =>
        n.title.toLowerCase().includes(k) ||
        n.body.toLowerCase().includes(k)
    );
}

function getRandomNote() {
    if (!APP_STATE.notes.length) return null;
    const idx = Math.floor(Math.random() * APP_STATE.notes.length);
    return APP_STATE.notes[idx];
}

// ============================
// Note Size & Fullscreen
// ============================
function cycleNoteSize(id) {
    const note = getNoteById(id);
    if (!note) return;

    const sizes = ['small', 'medium', 'large'];
    const currentIndex = sizes.indexOf(note.size || 'medium');
    note.size = sizes[(currentIndex + 1) % sizes.length];

    note.updatedAt = Date.now();
    saveNotes();
    renderNotes();
}

function toggleMenu(id) {
    // Close all other menus first
    closeAllMenus();

    // Find the menu for this note
    const menus = document.querySelectorAll('.note-menu-dropdown');
    menus.forEach(menu => {
        if (menu.dataset.id === id) {
            menu.classList.toggle('active');
        }
    });
}

function closeAllMenus() {
    const menus = document.querySelectorAll('.note-menu-dropdown');
    menus.forEach(menu => {
        menu.classList.remove('active');
    });
}

function toggleNoteFullscreen(id) {
    const note = getNoteById(id);
    if (!note) return;

    if (APP_STATE.fullscreenNoteId === id) {
        // Exit fullscreen
        APP_STATE.fullscreenNoteId = null;
        document.body.classList.remove('note-fullscreen');
        const overlay = document.getElementById('fullscreenNoteOverlay');
        if (overlay) overlay.remove();
    } else {
        // Enter fullscreen
        APP_STATE.fullscreenNoteId = id;
        document.body.classList.add('note-fullscreen');
        showFullscreenNote(note);
    }
}

function showFullscreenNote(note) {
    const date = new Date(note.createdAt).toLocaleDateString();
    const pinIcon = note.pinned ? '‚≠ê' : '‚òÜ';

    const overlay = document.createElement('div');
    overlay.id = 'fullscreenNoteOverlay';
    overlay.className = 'fullscreen-overlay';
    overlay.innerHTML = `
        <div class="fullscreen-note category-${note.category}">
            <div class="fullscreen-header">
                <div class="fullscreen-title-wrapper">
                    <h2 class="fullscreen-title">${escapeHTML(note.title)}</h2>
                    <span class="fullscreen-category-tag">${note.category}</span>
                </div>
                <div class="fullscreen-actions">
                    <button class="fullscreen-action-btn" onclick="togglePin('${note.id}')" title="${note.pinned ? 'Unpin' : 'Pin'}">
                        ${pinIcon}
                    </button>
                    <button class="fullscreen-action-btn" onclick="openEditModal('${note.id}')" title="Edit">
                        ‚úèÔ∏è
                    </button>
                    <button class="fullscreen-action-btn close-fullscreen" title="Exit fullscreen (ESC)">
                        ‚úï
                    </button>
                </div>
            </div>
            <div class="fullscreen-body">${escapeHTML(note.body)}</div>
            <div class="fullscreen-footer">
                <span>Created: ${date}</span>
                <span>Press ESC to exit</span>
            </div>
        </div>
    `;

    document.body.appendChild(overlay);

    // Close button
    overlay.querySelector('.close-fullscreen').addEventListener('click', () => {
        toggleNoteFullscreen(note.id);
    });

    // Click overlay to close
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            toggleNoteFullscreen(note.id);
        }
    });
}

function toggleTerminalFullscreen() {
    APP_STATE.terminalFullscreen = !APP_STATE.terminalFullscreen;
    document.body.classList.toggle('terminal-fullscreen', APP_STATE.terminalFullscreen);

    if (APP_STATE.terminalPowered) {
        const mode = APP_STATE.terminalFullscreen ? 'fullscreen' : 'normal';
        NoteCenterTerminal.printSuccess(`Terminal ${mode} mode activated.`);
    }
}

// ============================
// Rendering
// ============================
function getFilteredNotes() {
    if (APP_STATE.currentFilter === 'all') return APP_STATE.notes;
    return APP_STATE.notes.filter(n => n.category === APP_STATE.currentFilter);
}

function createNoteHTML(note) {
    const date = new Date(note.createdAt).toLocaleDateString();
    const pinIcon = note.pinned ? '‚≠ê' : '‚òÜ';
    const isSelected = APP_STATE.selectedNoteIds && APP_STATE.selectedNoteIds.has(note.id);
    const sizeClass = note.size ? `size-${note.size}` : 'size-medium';
    const sizeIcon = note.size === 'small' ? '‚¨ú' : note.size === 'large' ? '‚¨õ' : '‚ñ™Ô∏è';

    // Render body - support HTML content for rich text
    const bodyContent = note.bodyHtml || escapeHTML(note.body);

    return `
    <div class="sticky-note category-${note.category} ${sizeClass} ${isSelected ? 'selected' : ''}" data-id="${note.id}" role="listitem" tabindex="0">
        <div class="note-header">
            <div class="note-select-wrapper">
                <input type="checkbox" class="note-select-checkbox" data-id="${note.id}" ${isSelected ? 'checked' : ''} aria-label="Select note" />
                <h3 class="note-title">${escapeHTML(note.title)}</h3>
            </div>
            <div class="note-actions">
                <button class="note-btn primary pin-btn" aria-label="${note.pinned ? 'Unpin note' : 'Pin note'}" data-id="${note.id}">
                    ${pinIcon}
                </button>
                <button class="note-btn primary edit-btn" aria-label="Edit note" data-id="${note.id}">
                    ‚úèÔ∏è
                </button>
                <button class="note-btn primary menu-btn" aria-label="More actions" data-id="${note.id}" title="More">
                    ‚ãØ
                </button>
                <div class="note-menu-dropdown" data-id="${note.id}">
                    <button class="menu-size-btn" data-id="${note.id}">
                        <span class="icon">${sizeIcon}</span>
                        <span>Change Size</span>
                    </button>
                    <button class="menu-fullscreen-btn" data-id="${note.id}">
                        <span class="icon">‚õ∂</span>
                        <span>Fullscreen</span>
                    </button>
                    <button class="menu-delete-btn" data-id="${note.id}">
                        <span class="icon">üóëÔ∏è</span>
                        <span>Delete</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="note-body">${bodyContent}</div>
        <div class="note-footer">
            <span class="note-category-tag">${note.category}</span>
            <time class="note-date" datetime="${new Date(note.createdAt).toISOString()}">${date}</time>
        </div>
    </div>`;
}

function renderNotes() {
    const filtered = getFilteredNotes();
    const pinned = filtered.filter(n => n.pinned);

    // Board
    if (!filtered.length) {
        DOM.notesGrid.innerHTML = '';
        DOM.boardEmptyState.style.display = 'block';
    } else {
        DOM.boardEmptyState.style.display = 'none';
        DOM.notesGrid.innerHTML = filtered.map(createNoteHTML).join('');
    }

    // Dashboard
    if (!pinned.length) {
        DOM.dashboardGrid.innerHTML = '';
        DOM.dashboardEmptyState.style.display = 'block';
    } else {
        DOM.dashboardEmptyState.style.display = 'none';
        DOM.dashboardGrid.innerHTML = pinned.map(createNoteHTML).join('');
    }

    attachNoteEventListeners();
    updateBulkUI();
}

// ============================
// Bulk Selection
// ============================
function updateBulkUI() {
    if (!DOM.bulkBar) return;
    const count = APP_STATE.selectedNoteIds ? APP_STATE.selectedNoteIds.size : 0;
    if (DOM.bulkSelectionCount) {
        DOM.bulkSelectionCount.textContent = count + (count === 1 ? ' selected' : ' selected');
    }
    if (DOM.selectAllNotes) {
        const filtered = getFilteredNotes();
        if (!filtered.length || !count) {
            DOM.selectAllNotes.checked = false;
        } else {
            const allSelected = filtered.every(n => APP_STATE.selectedNoteIds.has(n.id));
            DOM.selectAllNotes.checked = allSelected;
        }
    }
}

function clearSelection() {
    if (!APP_STATE.selectedNoteIds) return;
    APP_STATE.selectedNoteIds.clear();
    updateBulkUI();
    renderNotes();
}

// ============================
// Note Event Listeners
// ============================
function attachNoteEventListeners() {

    // Menu size buttons (in dropdown)
    document.querySelectorAll('.menu-size-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            cycleNoteSize(btn.dataset.id);
            closeAllMenus();
        });
    });

    // Fullscreen buttons
    document.querySelectorAll('.fullscreen-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleNoteFullscreen(btn.dataset.id);
        });
    });

    // Menu fullscreen buttons (in dropdown)
    document.querySelectorAll('.menu-fullscreen-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleNoteFullscreen(btn.dataset.id);
            closeAllMenus();
        });
    });

    // Pin buttons
    document.querySelectorAll('.pin-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            togglePin(btn.dataset.id);
        });
    });

    // Edit buttons
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            openEditModal(btn.dataset.id);
        });
    });

    // Delete buttons (legacy - kept for backwards compatibility)
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Delete this note?')) {
                deleteNote(btn.dataset.id);
            }
        });
    });

    // Menu delete buttons (in dropdown)
    document.querySelectorAll('.menu-delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Delete this note?')) {
                deleteNote(btn.dataset.id);
                closeAllMenus();
            } else {
                closeAllMenus();
            }
        });
    });

    // Menu buttons (toggle dropdown)
    document.querySelectorAll('.menu-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleMenu(btn.dataset.id);
        });
    });

    // Selection checkboxes
    document.querySelectorAll('.note-select-checkbox').forEach(cb => {
        cb.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        cb.addEventListener('change', (e) => {
            const id = cb.dataset.id;
            if (!APP_STATE.selectedNoteIds) {
                APP_STATE.selectedNoteIds = new Set();
            }
            if (cb.checked) {
                APP_STATE.selectedNoteIds.add(id);
            } else {
                APP_STATE.selectedNoteIds.delete(id);
            }
            const card = cb.closest('.sticky-note');
            if (card) {
                card.classList.toggle('selected', cb.checked);
            }
            updateBulkUI();
        });
    });

    // Note cards (click to edit, keyboard support)
    document.querySelectorAll('.sticky-note').forEach(noteEl => {
        noteEl.addEventListener('click', (e) => {
            if (!e.target.closest('.note-btn') &&
                !e.target.closest('.note-select-checkbox') &&
                !e.target.closest('.note-menu-dropdown')) {
                openEditModal(noteEl.dataset.id);
            }
        });

        noteEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                openEditModal(noteEl.dataset.id);
            }
        });
    });

    // Close menus when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.note-menu-dropdown') && !e.target.closest('.menu-btn')) {
            closeAllMenus();
        }
    });
}

// ============================
// Modal Management
// ============================
function openAddModal(prefCategory = 'general') {
    APP_STATE.editingNoteId = null;
    DOM.modalTitle.textContent = 'New Note';
    DOM.noteTitle.value = '';
    DOM.noteBody.innerHTML = ''; // Clear the rich editor
    DOM.noteCategory.value = prefCategory;
    showModal();
}

function openEditModal(id) {
    const note = getNoteById(id);
    if (!note) return;

    APP_STATE.editingNoteId = id;
    DOM.modalTitle.textContent = 'Edit: ' + note.title;
    DOM.noteTitle.value = note.title;
    // Load HTML content for rich editor, fallback to plain text
    DOM.noteBody.innerHTML = note.bodyHtml || escapeHTML(note.body);
    DOM.noteCategory.value = note.category;
    showModal();
}

function showModal() {
    DOM.modal.style.display = 'flex';

    // Small shake animation for fun
    document.body.style.animation = 'shake 0.3s ease-in-out';
    setTimeout(() => { document.body.style.animation = ''; }, 300);

    setTimeout(() => {
        DOM.noteTitle.focus();
        DOM.noteTitle.select();
    }, 100);
}

function hideModal() {
    if (!DOM.modal) return;

    DOM.modal.style.display = 'none';

    if (DOM.noteForm) {
        DOM.noteForm.reset();
    }

    // Clear the rich editor (form.reset doesn't work on contenteditable)
    if (DOM.noteBody) {
        DOM.noteBody.innerHTML = '';
    }

    APP_STATE.editingNoteId = null;
}

// ============================
// Terminal Power Management
// ============================
function powerOnTerminal() {
    APP_STATE.terminalPowered = true;
    DOM.powerBtn.classList.add('on');
    DOM.terminalInputLine.style.display = 'flex';

    if (!APP_STATE.bootSequenceShown) {
        APP_STATE.bootSequenceShown = true;
        NoteCenterTerminal.showBootSequence();
    } else {
        NoteCenterTerminal.printSuccess('System online.');
        DOM.terminalInput.focus();
    }
}

function powerOffTerminal() {
    APP_STATE.terminalPowered = false;
    DOM.powerBtn.classList.remove('on');
    DOM.terminalInputLine.style.display = 'none';
    DOM.terminalOutput.innerHTML =
        '<div class="terminal-line terminal-off">System offline. Press power button to boot.</div>';
}

// ============================
// Event Listeners
// ============================
function attachEventListeners() {
    // UI mode toggle
    if (DOM.uiModeToggle) {
        DOM.uiModeToggle.addEventListener('change', toggleUIMode);
    }

    // Dark mode toggle
    if (DOM.darkModeToggle) {
        DOM.darkModeToggle.addEventListener('change', toggleDarkMode);
    }

    // Tabs
    DOM.navTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            switchView(tab.dataset.view);
        });
    });

    // Filters
    DOM.filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            APP_STATE.currentFilter = btn.dataset.category;
            DOM.filterButtons.forEach(b => b.classList.toggle('active', b === btn));
            renderNotes();
        });
    });

    // New note button
    if (DOM.addNoteBtn) {
        DOM.addNoteBtn.addEventListener('click', () => openAddModal());
    }

    // Export button
    if (DOM.exportSessionBtn) {
        DOM.exportSessionBtn.addEventListener('click', () => {
            if (APP_STATE.terminalPowered) {
                NoteCenterTerminal.printSuccess('Preparing notes export...');
            }
            exportSession();
        });
    }

    // Bulk selection: Select all
    if (DOM.selectAllNotes) {
        DOM.selectAllNotes.addEventListener('change', () => {
            if (!APP_STATE.selectedNoteIds) {
                APP_STATE.selectedNoteIds = new Set();
            }
            if (DOM.selectAllNotes.checked) {
                const filtered = getFilteredNotes();
                filtered.forEach(n => APP_STATE.selectedNoteIds.add(n.id));
            } else {
                clearSelection();
                return;
            }
            renderNotes();
        });
    }

    // Bulk selection: Apply category
    if (DOM.applyBulkCategoryBtn) {
        DOM.applyBulkCategoryBtn.addEventListener('click', () => {
            const cat = DOM.bulkCategorySelect ? DOM.bulkCategorySelect.value : '';
            if (!cat) return;
            if (!APP_STATE.selectedNoteIds || !APP_STATE.selectedNoteIds.size) return;

            const changes = [];
            APP_STATE.selectedNoteIds.forEach(id => {
                const note = getNoteById(id);
                if (note && note.category !== cat) {
                    changes.push({ id: note.id, prevCategory: note.category });
                    note.category = cat;
                    note.updatedAt = Date.now();
                }
            });

            if (changes.length) {
                APP_STATE.lastAction = {
                    type: 'bulkCategory',
                    changes
                };
            }

            saveNotes();
            renderNotes();
        });
    }

    // Bulk selection: Delete
    if (DOM.bulkDeleteBtn) {
        DOM.bulkDeleteBtn.addEventListener('click', () => {
            if (!APP_STATE.selectedNoteIds || !APP_STATE.selectedNoteIds.size) return;
            if (!confirm('Delete all selected notes? This cannot be undone.')) return;

            const items = [];
            APP_STATE.notes.forEach((note, index) => {
                if (APP_STATE.selectedNoteIds.has(note.id)) {
                    items.push({ note, index });
                }
            });

            if (items.length) {
                APP_STATE.lastAction = {
                    type: 'bulkDelete',
                    items
                };
            }

            APP_STATE.notes = APP_STATE.notes.filter(n => !APP_STATE.selectedNoteIds.has(n.id));
            saveNotes();
            clearSelection();
        });
    }

    // Bulk selection: Clear
    if (DOM.clearSelectionBtn) {
        DOM.clearSelectionBtn.addEventListener('click', () => {
            clearSelection();
        });
    }

    // Modal close buttons
    if (DOM.modalClose) DOM.modalClose.addEventListener('click', hideModal);
    if (DOM.cancelBtn) DOM.cancelBtn.addEventListener('click', hideModal);

    // Modal overlay click
    if (DOM.modal) {
        DOM.modal.addEventListener('click', (e) => {
            if (e.target === DOM.modal) hideModal();
        });
    }

    // ESC key handling
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (DOM.modal.style.display === 'flex') {
                hideModal();
            } else if (APP_STATE.fullscreenNoteId) {
                toggleNoteFullscreen(APP_STATE.fullscreenNoteId);
            } else if (APP_STATE.terminalFullscreen) {
                toggleTerminalFullscreen();
            } else if (document.body.classList.contains('boss-mode')) {
                document.body.classList.remove('boss-mode');
                if (APP_STATE.terminalPowered) {
                    NoteCenterTerminal.printSuccess('Boss mode deactivated.');
                }
            }
        }
    });

    // Form submit
    if (DOM.noteForm) {
        DOM.noteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            e.stopPropagation();

            const title = DOM.noteTitle ? DOM.noteTitle.value.trim() : '';
            // Get HTML content from contenteditable div
            const bodyHtml = DOM.noteBody ? DOM.noteBody.innerHTML.trim() : '';
            // Also get plain text version for backwards compatibility
            const body = DOM.noteBody ? DOM.noteBody.innerText.trim() : '';
            const category = DOM.noteCategory ? DOM.noteCategory.value : 'general';

            if (!title || !body) {
                alert('Please fill in both title and note fields.');
                return;
            }

            if (APP_STATE.editingNoteId) {
                updateNote(APP_STATE.editingNoteId, title, body, category, bodyHtml);
            } else {
                createNote(title, body, category, bodyHtml);
            }

            hideModal();
        });
    }

    // Formatting toolbar buttons
    document.querySelectorAll('.format-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const command = btn.dataset.command;
            document.execCommand(command, false, null);
            DOM.noteBody.focus();
        });
    });

    // Keyboard shortcuts for formatting
    if (DOM.noteBody) {
        DOM.noteBody.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'b') {
                    e.preventDefault();
                    document.execCommand('bold', false, null);
                } else if (e.key === 'i') {
                    e.preventDefault();
                    document.execCommand('italic', false, null);
                }
            }
        });
    }

    // Terminal power button
    if (DOM.powerBtn) {
        DOM.powerBtn.addEventListener('click', () => {
            if (APP_STATE.terminalPowered) {
                powerOffTerminal();
            } else {
                powerOnTerminal();
            }
        });
    }

    // Terminal fullscreen button
    const terminalFullscreenBtn = document.querySelector('.terminal-fullscreen-btn');
    if (terminalFullscreenBtn) {
        terminalFullscreenBtn.addEventListener('click', () => {
            toggleTerminalFullscreen();
        });
    }

    // Mobile terminal toggle
    if (DOM.mobileTerminalToggle) {
        DOM.mobileTerminalToggle.addEventListener('click', () => {
            DOM.terminalPanel.classList.toggle('mobile-open');
        });
    }
}

function switchView(view) {
    APP_STATE.currentView = view;

    DOM.navTabs.forEach(tab => {
        const isActive = tab.dataset.view === view;
        tab.classList.toggle('active', isActive);
        tab.setAttribute('aria-pressed', isActive);
    });

    if (view === 'board') {
        DOM.boardView.style.display = 'block';
        DOM.dashboardView.style.display = 'none';
    } else {
        DOM.boardView.style.display = 'none';
        DOM.dashboardView.style.display = 'block';
    }
}

// ============================
// Utilities
// ============================
function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

function escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

// ============================
// Export Feature
// ============================
function exportSession() {
    try {
        const notes = APP_STATE.notes || [];
        const now = new Date();
        const exportedAt = now.toISOString();

        function formatTimestamp(ts) {
            if (!ts) return '';
            try {
                return new Date(ts).toLocaleString();
            } catch {
                return String(ts);
            }
        }

        let html = '';
        html += '<!DOCTYPE html><html><head><meta charset="UTF-8">';
        html += '<title>NoteCenter Export</title>';
        html += '<style>';
        html += 'body{font-family:system-ui,-apple-system,sans-serif;background:#f5f5f7;color:#222;margin:0;padding:1.5rem;line-height:1.6;}';
        html += 'h1{margin-top:0;font-size:1.8rem;color:#ff6b9d;}';
        html += '.meta{font-size:0.9rem;color:#555;margin-bottom:2rem;padding:1rem;background:#fff;border-radius:8px;}';
        html += '.note{background:#ffffff;border-radius:8px;padding:1rem;margin-bottom:1rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);border-left:4px solid #ff6b9d;}';
        html += '.note-header{display:flex;justify-content:space-between;gap:1rem;margin-bottom:0.5rem;}';
        html += '.note-title{font-weight:600;font-size:1.1rem;}';
        html += '.note-meta{font-size:0.8rem;color:#666;text-align:right;}';
        html += '.note-category{display:inline-block;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.06em;padding:0.2rem 0.5rem;border-radius:999px;border:1px solid rgba(0,0,0,0.2);background:rgba(255,107,157,0.1);}';
        html += '.note-body{white-space:pre-wrap;font-size:0.95rem;margin-top:0.5rem;}';
        html += '.pinned{border-left-color:#ffb000;background:#fffbf0;}';

/* Universal back button */
#backToHome{
  position:fixed; right:16px; top:16px;
  padding:10px 16px;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  color: #ffffff;
  font: 600 13px/1 system-ui, sans-serif;
  z-index:9999;
  cursor:pointer;
  transition:all .15s ease;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:6px;
}
#backToHome:hover{
  background: rgba(255,255,255,0.15);
  border-color: rgba(255,255,255,0.4);
  transform:translateY(-1px);
}
#backToHome:active{transform:scale(0.97);}
@media (max-width:640px){
  #backToHome{padding:8px 12px; font-size:12px; right:12px; top:12px;}
}
        html += '</style></head><body>';
<a id="backToHome" href="index.html" title="Back to Homepage">
  <span>‚Üê</span>
  <span>Home</span>
</a>

        html += '<h1>üìù NoteCenter Export</h1>';
        html += '<div class="meta">';
        html += '<strong>Exported:</strong> ' + exportedAt + '<br>';
        html += '<strong>Total notes:</strong> ' + notes.length;
        html += '</div>';

        notes.forEach((note) => {
            const cat = note.category || 'general';
            const title = note.title ? String(note.title).replace(/</g,'&lt;').replace(/>/g,'&gt;') : '(Untitled)';
            const body = note.body ? String(note.body).replace(/</g,'&lt;').replace(/>/g,'&gt;') : '';
            html += '<article class="note' + (note.pinned ? ' pinned' : '') + '">';
            html += '<div class="note-header">';
            html += '<div class="note-title">' + (note.pinned ? '‚≠ê ' : '') + title + '</div>';
            html += '<div class="note-meta">';
            html += '<span class="note-category">' + cat + '</span><br>';
            html += '<small>Created: ' + formatTimestamp(note.createdAt) + '</small><br>';
            html += '<small>Updated: ' + formatTimestamp(note.updatedAt) + '</small>';
            html += '</div></div>';
            html += '<div class="note-body">' + body + '</div>';
            html += '</article>';
        });

        html += '</body></html>';

        // Create and download
        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'notecenter-notes-' + Date.now() + '.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        if (APP_STATE.terminalPowered) {
            NoteCenterTerminal.printSuccess('‚úì Exported ' + notes.length + ' notes to HTML file');
        }
    } catch (e) {
        console.error('Export error:', e);
        if (APP_STATE.terminalPowered) {
            NoteCenterTerminal.printError('Export failed: ' + e.message);
        } else {
            alert('Export failed: ' + e.message);
        }
    }
}

// Quick note creation from terminal
function createQuickNoteFromTerminal(text) {
    const body = String(text || '').trim();
    if (!body) return;

    const num = APP_STATE.quickNoteCounter || 1;
    const title = 'Quick Note ' + num;
    APP_STATE.quickNoteCounter = num + 1;

    const note = createNote(title, body, 'general');

    if (window.NoteCenterTerminal) {
        NoteCenterTerminal.printSuccess(
            'Created quick note [' + note.id.substring(0, 8) + '] "' + title + '"'
        );
    }
}

// Undo last action
function undoLastAction() {
    const action = APP_STATE.lastAction;
    if (!action) {
        return { success: false, message: 'Nothing to undo.' };
    }

    const notes = APP_STATE.notes;

    switch (action.type) {
        case 'create': {
            const idx = notes.findIndex(n => n.id === action.noteId);
            if (idx !== -1) {
                const [removed] = notes.splice(idx, 1);
                APP_STATE.lastAction = null;
                saveNotes();
                renderNotes();
                return { success: true, message: 'Removed recently created note "' + removed.title + '"' };
            }
            break;
        }

        case 'delete': {
            const { note, index } = action;
            if (!note) break;
            let insertIndex = index;
            if (insertIndex < 0 || insertIndex > notes.length) {
                insertIndex = notes.length;
            }
            notes.splice(insertIndex, 0, note);
            APP_STATE.lastAction = null;
            saveNotes();
            renderNotes();
            return { success: true, message: 'Restored deleted note "' + note.title + '"' };
        }

        case 'pinToggle': {
            const note = notes.find(n => n.id === action.id);
            if (!note) break;
            note.pinned = action.wasPinned;
            APP_STATE.lastAction = null;
            saveNotes();
            renderNotes();
            return { success: true, message: 'Restored pin state for "' + note.title + '"' };
        }

        case 'bulkDelete': {
            if (!Array.isArray(action.items) || !action.items.length) break;
            action.items
                .sort((a, b) => a.index - b.index)
                .forEach(entry => {
                    let insertIndex = entry.index;
                    if (insertIndex < 0 || insertIndex > notes.length) {
                        insertIndex = notes.length;
                    }
                    notes.splice(insertIndex, 0, entry.note);
                });
            APP_STATE.lastAction = null;
            saveNotes();
            renderNotes();
            return { success: true, message: 'Restored ' + action.items.length + ' deleted notes' };
        }

        case 'bulkCategory': {
            if (!Array.isArray(action.changes) || !action.changes.length) break;
            action.changes.forEach(ch => {
                const note = notes.find(n => n.id === ch.id);
                if (note) {
                    note.category = ch.prevCategory;
                    note.updatedAt = Date.now();
                }
            });
            APP_STATE.lastAction = null;
            saveNotes();
            renderNotes();
            return { success: true, message: 'Restored categories for ' + action.changes.length + ' notes' };
        }

        default:
            break;
    }

    return { success: false, message: 'Last action cannot be undone.' };
}

// ============================
// NoteCenter Terminal Module
// ============================
const NoteCenterTerminal = (function () {
    const tips = [
        "Break large tasks into smaller steps.",
        "Use the Pomodoro Technique: 25 min work, 5 min break.",
        "Review your notes at the end of each day.",
        "Pin your most important note to the Dashboard.",
        "Write down ideas immediately before you forget them.",
        "Use categories to organize priorities."
    ];

    const quests = [
        "Quest: Create 3 notes for Future You.",
        "Quest: Pin exactly one task you must do today.",
        "Quest: Review all your Ideas notes and pick one.",
        "Quest: Delete an old note you no longer need.",
        "Quest: Write a thank-you note in Personal."
    ];

    const bootSequence = [
        'Booting NoteCenter OS...',
        'Loading kernel modules...',
        'Initializing note database...',
        'Mounting file systems...',
        '<span class="terminal-success">Boot complete!</span>',
        '',
        'Welcome to NoteCenter Terminal.',
        'Type /help to get started.',
        ''
    ];

    let currentListContext = null;

    // Printing helpers
    function print(lines) {
        if (!Array.isArray(lines)) lines = [lines];

        // Check if the user is already near the bottom *before* we add new lines.
        // If they've scrolled up to read history, we won't yank them back down.
        const nearBottom = Math.abs(
            DOM.terminalOutput.scrollHeight -
            DOM.terminalOutput.scrollTop -
            DOM.terminalOutput.clientHeight
        ) < 5;

        lines.forEach(line => {
            const div = document.createElement('div');
            div.className = 'terminal-line';
            div.innerHTML = line;
            DOM.terminalOutput.appendChild(div);
        });

        if (nearBottom) {
            DOM.terminalOutput.scrollTop = DOM.terminalOutput.scrollHeight;
        }
    }

    function printError(msg) {
        print('<span class="terminal-error">' + escapeHTML(msg) + '</span>');
    }

    function printSuccess(msg) {
        print('<span class="terminal-success">' + escapeHTML(msg) + '</span>');
    }

    // Command parsing
    function parseCommand(input) {
        input = input.trim();
        if (!input) return { cmd: '', args: [] };

        if (input.startsWith('/')) input = input.slice(1);

        const regex = /"([^"]+)"|(\S+)/g;
        const tokens = [];
        let match;
        while ((match = regex.exec(input)) !== null) {
            tokens.push(match[1] || match[2]);
        }

        const cmd = (tokens[0] || '').toLowerCase();
        const args = tokens.slice(1);
        return { cmd, args };
    }

    // Resolve note target
    function resolveNoteTarget(token) {
        if (!token) return null;

        const n = parseInt(token, 10);
        if (!isNaN(n) && n >= 1 && currentListContext && n <= currentListContext.length) {
            const id = currentListContext[n - 1];
            const note = getNoteById(id);
            if (note) return note;
        }

        let note = APP_STATE.notes.find(n => n.id === token || n.id.startsWith(token));
        if (note) return note;

        const target = token.toLowerCase();
        const matches = APP_STATE.notes.filter(n =>
            n.title.toLowerCase().includes(target)
        );

        if (!matches.length) {
            printError('No note found for "' + token + '". Run /list to see notes.');
            return null;
        }

        if (matches.length === 1) {
            return matches[0];
        }

        printSuccess('Multiple notes match "' + token + '":');
        currentListContext = matches.map(n => n.id);
        matches.forEach((note, i) => {
            const pin = note.pinned ? ' üìå' : '';
            print('  ' + (i + 1) + ') [' + note.id.substring(0, 8) + '] "' +
                escapeHTML(note.title) + '"' + pin);
        });
        print('Use /show <number> or /open <number>.');
        return null;
    }

    // List notes
    function printNotesList(notes, title) {
        if (!notes.length) {
            print(title);
            print('  No notes yet. Create one with /new');
            currentListContext = null;
            return;
        }

        currentListContext = notes.map(n => n.id);
        print(title);
        notes.forEach((note, i) => {
            const pin = note.pinned ? ' üìå' : '';
            print('  ' + (i + 1) + ') [' + note.id.substring(0, 8) + '] "' +
                escapeHTML(note.title) + '"' + pin);
        });
    }

    // Command handlers
    function isKnownCommand(cmd) {
        if (!cmd) return false;
        const known = [
            'h','?','ls','notes',
            'list','board','dash','dashboard',
            'new','create','add',
            'open','show','view',
            'find','search',
            'pin','unpin',
            'delete','remove',
            'clear','help','about',
            'time','stats','tip','quest',
            'theme','panic','boss',
            'undo','export',
            'setname','setnamehost'
        ];
        return known.indexOf(cmd) !== -1;
    }

    function handleCommand(parsed) {
        const { cmd, args } = parsed;

        const c = ({
            'h': 'help',
            '?': 'help',
            'ls': 'list',
            'notes': 'list',
            'new': 'new',
            'create': 'new',
            'add': 'new',
            'open': 'open',
            'show': 'show',
            'view': 'show',
            'find': 'find',
            'search': 'find',
            'undo': 'undo',
            'export': 'export'
        })[cmd] || cmd;

        switch (c) {
            case '':
                break;

            case 'setname': {
                if (!args.length) {
                    printError('Usage: setname <new name>');
                    break;
                }
                const newName = args.join(' ');
                const trimmed = newName.trim();
                if (!trimmed) {
                    printError('Please provide a valid name.');
                    break;
                }
                setAppName(trimmed);
                printSuccess('NoteCenter name set to "' + trimmed + '".');
                break;
            }

            case 'setnamehost': {
                if (!args.length) {
                    printError('Usage: setnameHost <user name>');
                    break;
                }
                const newUser = args.join(' ');
                const trimmedUser = newUser.trim();
                if (!trimmedUser) {
                    printError('Please provide a valid user name.');
                    break;
                }
                setHostUser(trimmedUser);
                const app = (APP_STATE.appName || 'NoteCenter OS');
                printSuccess('Terminal identity set to "' + trimmedUser + '@' + app + '".');
                break;
            }

            case 'help':
                showHelp();
                break;

            case 'clear':
                DOM.terminalOutput.innerHTML = '';
                break;

            case 'about':
                showAbout();
                break;

            case 'time':
                showTime();
                break;

            case 'export':
                if (!APP_STATE.notes || !APP_STATE.notes.length) {
                    printError('No notes to export.');
                    break;
                }
                printSuccess('Preparing notes export...');
                exportSession();
                break;

            case 'list': {
                const pinnedOnly = args[0] && args[0].toLowerCase() === 'pinned';
                const notes = pinnedOnly
                    ? APP_STATE.notes.filter(n => n.pinned)
                    : APP_STATE.notes;
                const title = pinnedOnly
                    ? '<span class="terminal-success">Pinned Notes:</span>'
                    : '<span class="terminal-success">Notes:</span>';
                printNotesList(notes, title);
                break;
            }

            case 'new': {
                const valid = ['general', 'work', 'personal', 'ideas'];

                // 1) No args or just a category ‚Üí open the modal
                if (args.length === 0 || (args.length === 1 && valid.includes(args[0].toLowerCase()))) {
                    let cat = 'general';
                    if (args[0] && valid.includes(args[0].toLowerCase())) {
                        cat = args[0].toLowerCase();
                    }
                    printSuccess('Opening new note editor' + (cat !== 'general' ? ' (' + cat + ')' : '') + '...');
                    openAddModal(cat);
                    break;
                }

                // 2) Title + body (+ optional category) ‚Üí create note directly
                if (args.length >= 2) {
                    const title = args[0];
                    const body = args[1];

                    // Look at the LAST argument for a category so that:
                    //   new "Title" "Body" ideas
                    //   new "Title" "Body" Ideas
                    // both work reliably.
                    let cat = 'general';
                    if (args.length >= 3) {
                        const lastArg = args[args.length - 1].toLowerCase();
                        const catMap = {
                            general: 'general',
                            gen: 'general',
                            g: 'general',
                            work: 'work',
                            w: 'work',
                            personal: 'personal',
                            p: 'personal',
                            ideas: 'ideas',
                            idea: 'ideas',
                            i: 'ideas'
                        };
                        if (catMap[lastArg]) {
                            cat = catMap[lastArg];
                        }
                    }

                    const note = createNote(title, body, cat);
                    printSuccess('Created note [' + note.id.substring(0, 8) + '] "' + escapeHTML(note.title) + '" in ' + cat);
                } else {
                    printError('Usage: /new "Title" "Body" [category] or /new [category]');
                }
                break;
            }

            case 'open': {
                if (!args.length || args[0].toLowerCase() === 'new') {
                    printSuccess('Opening new note editor...');
                    openAddModal();
                    break;
                }
                const note = resolveNoteTarget(args[0]);
                if (!note) break;
                openEditModal(note.id);
                printSuccess('Opened "' + note.title + '" in editor');
                break;
            }

            case 'show': {
                if (!args.length) {
                    printError('Usage: /show <target>');
                    break;
                }
                const note = resolveNoteTarget(args[0]);
                if (!note) break;
                print([
                    '',
                    '<span class="terminal-success">[' + note.id.substring(0, 8) + '] "' +
                    escapeHTML(note.title) + '"</span>',
                    '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',
                    escapeHTML(note.body),
                    '',
                    'Category: ' + note.category +
                    ' | Created: ' + new Date(note.createdAt).toLocaleDateString(),
                    ''
                ]);
                break;
            }

            case 'find': {
                if (!args.length) {
                    printError('Usage: /find <keyword>');
                    break;
                }
                const term = args.join(' ');
                const matches = searchNotes(term);
                const title = '<span class="terminal-success">Search results for "' +
                    escapeHTML(term) + '":</span>';
                printNotesList(matches, title);
                break;
            }

            case 'pin': {
                if (!args.length) {
                    printError('Usage: /pin <target>');
                    break;
                }
                const note = resolveNoteTarget(args[0]);
                if (!note) break;
                if (note.pinned) {
                    print('Note is already pinned.');
                    break;
                }
                togglePin(note.id);
                printSuccess('Pinned "' + note.title + '"');
                break;
            }

            case 'unpin': {
                if (!args.length) {
                    printError('Usage: /unpin <target>');
                    break;
                }
                const note = resolveNoteTarget(args[0]);
                if (!note) break;
                if (!note.pinned) {
                    print('Note is not pinned.');
                    break;
                }
                togglePin(note.id);
                printSuccess('Unpinned "' + note.title + '"');
                break;
            }

            case 'delete': {
                if (!args.length) {
                    printError('Usage: /delete <target>');
                    break;
                }
                const note = resolveNoteTarget(args[0]);
                if (!note) break;
                deleteNote(note.id);
                printSuccess('Deleted "' + note.title + '"');
                break;
            }

            case 'undo': {
                const result = undoLastAction();
                if (!result || !result.success) {
                    printError(result ? result.message : 'Nothing to undo.');
                } else {
                    printSuccess(result.message);
                }
                break;
            }

            case 'stats':
                showStats();
                break;

            case 'tip':
                showTip();
                break;

            case 'quest':
                showQuest();
                break;

            case 'theme':
                handleTheme(args);
                break;

            case 'panic':
                toggleBossMode();
                break;

            default:
                printError('Unknown command: ' + cmd + '. Type /help for commands.');
        }
    }

    // Command detail functions
    function showHelp() {
        print([
            '<span class="terminal-success">Commands:</span>',
            '',
            'Creating / opening:',
            '  /new [category]       - New note',
            '  /open new             - New note',
            '  /open <target>        - Open note in editor',
            '',
            'Listing & viewing:',
            '  /list                 - List notes',
            '  /list pinned          - List pinned notes',
            '  /show <target>        - View a note',
            '  /find <keyword>       - Search notes',
            '',
            'Pinning & deleting:',
            '  /pin <target>         - Pin note',
            '  /unpin <target>       - Unpin note',
            '  /delete <target>      - Delete note',
            '',
            'Info & fun:',
            '  /stats                - Note statistics',
            '  /time                 - Time & uptime',
            '  /tip                  - Productivity tip',
            '  /quest                - Small task suggestion',
            '  /theme <green|amber|matrix>',
            '  /panic                - Toggle boss mode',
            '',
            'Other:',
            '  /export               - Export all notes to HTML',
            '  /undo                 - Undo last note change',
            '  /clear                - Clear terminal',
            '  /about                - About this app',
            ''
        ]);
    }

    function showAbout() {
        print([
            '<span class="terminal-success">NoteCenter Terminal v1.0.0</span>',
            'Retro terminal for your sticky-note OS.',
            'Use /help to see commands.'
        ]);
    }

    function showTime() {
        const now = new Date();
        const uptimeSec = Math.floor((Date.now() - APP_STATE.sessionStart) / 1000);
        const m = Math.floor(uptimeSec / 60);
        const s = uptimeSec % 60;

        print([
            '<span class="terminal-success">Time:</span>',
            'Current time: ' + now.toLocaleTimeString(),
            'Current date: ' + now.toLocaleDateString(),
            'Session uptime: ' + m + 'm ' + s + 's'
        ]);
    }

    function showStats() {
        const total = APP_STATE.notes.length;
        const pinned = APP_STATE.notes.filter(n => n.pinned).length;
        const byCat = APP_STATE.notes.reduce((acc, n) => {
            acc[n.category] = (acc[n.category] || 0) + 1;
            return acc;
        }, {});

        print('<span class="terminal-success">Note stats:</span>');
        print('Total notes: ' + total);
        print('Pinned: ' + pinned);
        Object.keys(byCat).forEach(cat => {
            print('  ' + cat + ': ' + byCat[cat]);
        });
    }

    function showTip() {
        const tip = tips[Math.floor(Math.random() * tips.length)];
        printSuccess('Tip: ' + tip);
    }

    function showQuest() {
        const quest = quests[Math.floor(Math.random() * quests.length)];
        printSuccess(quest);
    }

    function handleTheme(args) {
        const theme = (args[0] || '').toLowerCase();
        const allThemes = ['theme-amber', 'theme-matrix', 'theme-cyan', 'theme-pink', 'theme-red', 'theme-purple', 'theme-blue', 'theme-orange', 'theme-white', 'theme-dracula'];

        // Remove all theme classes
        allThemes.forEach(t => document.body.classList.remove(t));

        const validThemes = {
            'amber': 'amber',
            'matrix': 'matrix',
            'cyan': 'cyan',
            'pink': 'pink',
            'red': 'red',
            'purple': 'purple',
            'blue': 'blue',
            'orange': 'orange',
            'white': 'white',
            'dracula': 'dracula'
        };

        if (validThemes[theme]) {
            document.body.classList.add(`theme-${validThemes[theme]}`);
            printSuccess(`Theme set to ${theme}`);
        } else if (!theme || theme === 'green' || theme === 'default') {
            printSuccess('Theme set to default green');
        } else if (theme === 'list') {
            printSuccess('Available themes: green (default), amber, matrix, cyan, pink, red, purple, blue, orange, white, dracula');
        } else {
            printError('Unknown theme. Use /theme list to see available themes');
        }
    }

    function toggleBossMode() {
        document.body.classList.toggle('boss-mode');
        if (document.body.classList.contains('boss-mode')) {
            printSuccess('Boss mode activated');
        } else {
            printSuccess('Boss mode deactivated');
        }
    }

    // Boot sequence
    function showBootSequence() {
        DOM.terminalOutput.innerHTML = '';
        bootSequence.forEach((line, i) => {
            setTimeout(() => print(line), i * 200);
        });
        setTimeout(() => {
            DOM.terminalInput.focus();
        }, bootSequence.length * 200 + 300);
    }

    // Public API
    function init() {
        DOM.terminalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && APP_STATE.terminalPowered) {
                const value = DOM.terminalInput.value.trim();
                DOM.terminalInput.value = '';

                if (value) {
                    print('<span class="terminal-prompt">' +
                        escapeHTML(getTerminalPrompt()) +
                        '</span> ' + escapeHTML(value));

                    const parsed = parseCommand(value);
                    if (isKnownCommand(parsed.cmd)) {
                        handleCommand(parsed);
                    } else {
                        createQuickNoteFromTerminal(value);
                    }
                }
            }
        });
    }

    return {
        init,
        print,
        printError,
        printSuccess,
        showBootSequence
    };
})();

// ============================
// DOM Ready
// ============================
document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>
