<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cube Memory — Snap Focus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bgTop:#06070b;
  --bgMid:#0b0f1a;
  --bgBot:#070812;

  --panel:#141a2a;
  --panelHi:#1f2842;
  --text:#e7e9ef;
  --muted:#a0a7b8;

  --edge:rgba(255,255,255,.10);
  --edge2:rgba(255,255,255,.05);

  --active:#3b82f6;
  --activeText:#ffffff;

  --shadow:rgba(0,0,0,.45);
  --glow:rgba(100,170,255,.22);
  --glow2:rgba(120,120,255,.10);
}

*{ box-sizing:border-box; }

html,body{
  margin:0;
  height:100%;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color:var(--text);
  overflow:hidden;
  background: radial-gradient(1200px 800px at 50% 25%, #0b1020 0%, #070a14 45%, #04060c 100%);
}

/* starfield + subtle vignette */
body::before{
  content:"";
  position:fixed;
  inset:-2px;
  pointer-events:none;
  background:
    radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.35), transparent 60%),
    radial-gradient(1px 1px at 28% 74%, rgba(255,255,255,.22), transparent 60%),
    radial-gradient(1px 1px at 44% 26%, rgba(255,255,255,.18), transparent 60%),
    radial-gradient(1px 1px at 66% 38%, rgba(255,255,255,.26), transparent 60%),
    radial-gradient(1px 1px at 78% 16%, rgba(255,255,255,.22), transparent 60%),
    radial-gradient(1px 1px at 83% 71%, rgba(255,255,255,.20), transparent 60%),
    radial-gradient(1px 1px at 6% 58%,  rgba(255,255,255,.18), transparent 60%),
    radial-gradient(1px 1px at 92% 44%, rgba(255,255,255,.16), transparent 60%),
    radial-gradient(1px 1px at 54% 86%, rgba(255,255,255,.14), transparent 60%),
    radial-gradient(2px 2px at 22% 40%, rgba(255,255,255,.20), transparent 65%),
    radial-gradient(2px 2px at 74% 52%, rgba(255,255,255,.16), transparent 65%),
    radial-gradient(2px 2px at 40% 62%, rgba(255,255,255,.14), transparent 65%),
    radial-gradient(1200px 900px at 50% 55%, transparent 55%, rgba(0,0,0,.55) 100%);
  opacity:.78;
}

#app{
  height:100%;
  display:grid;
  place-items:center;
}

#hud{
  position:fixed;
  top:14px;
  left:0;
  right:0;
  display:flex;
  justify-content:center;
  gap:18px;
  font-size:13px;
  letter-spacing:.55px;
  color:rgba(231,233,239,.82);
  pointer-events:none;
}

#hud > div{
  padding:8px 12px;
  border-radius:999px;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.scene{
  width:240px;
  height:240px;
  perspective:980px;
  position:relative;
  filter: drop-shadow(0 30px 40px rgba(0,0,0,.65)) drop-shadow(0 0 24px rgba(80,140,255,.15));
}

/* quiet pocket behind the cube so it reads as foreground */
.scene::before{
  content:"";
  position:absolute;
  inset:-140px;
  background: radial-gradient(circle, rgba(5,8,16,.88) 0%, rgba(5,8,16,.55) 42%, transparent 72%);
  z-index:-1;
}


/* ambient underglow */
.scene::after{
  content:"";
  position:absolute;
  left:50%;
  top:55%;
  width:320px;
  height:220px;
  transform: translate(-50%, 0);
  background:
    radial-gradient(closest-side, var(--glow), transparent 68%),
    radial-gradient(closest-side, var(--glow2), transparent 72%);
  filter: blur(10px);
  opacity:.9;
  z-index:0;
}

.cube{
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;

  /* base pose + snap focus (JS sets vars) */
  transform:
    rotateX(-18deg) rotateY(28deg)
    rotateX(var(--focusX, 0deg)) rotateY(var(--focusY, 0deg))
    translateY(var(--floatY, 0px));
  transition: transform 320ms cubic-bezier(.2,.9,.2,1);
  z-index:1;
}

/* gentle floating like it's in space */
@keyframes floaty{
  0%   { --floatY: 0px; }
  50%  { --floatY: -7px; }
  100% { --floatY: 0px; }
}
.scene:not(.playing) .cube{
  animation: floaty 3.8s ease-in-out infinite;
}

/* face styling: clean "space metal" */
.face{
  position:absolute;
  width:240px;
  height:240px;

  background:
    radial-gradient(800px 520px at 22% 18%, rgba(255,255,255,.10), transparent 44%),
    radial-gradient(700px 520px at 78% 86%, rgba(0,0,0,.35), transparent 54%),
    linear-gradient(180deg, var(--panelHi), var(--panel));

  border:1px solid var(--edge);
  outline:1px solid rgba(255,255,255,.02);
  border-radius:16px;

  display:flex;
  align-items:center;
  justify-content:center;

  font-size:56px;
  font-weight: 820;
  letter-spacing:.55px;
  color:var(--text);
  text-shadow: 0 2px 10px rgba(0,0,0,.35);

  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.05),
    inset 0 -18px 40px rgba(0,0,0,.30),
    0 18px 30px var(--shadow);

  backface-visibility:hidden;
  transition:
    background 120ms ease,
    box-shadow 120ms ease,
    transform 120ms ease,
    color 120ms ease,
    border-color 120ms ease;
}

.face::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.12),
    inset 0 0 12px rgba(255,255,255,.04);
  opacity:.78;
}

.face::after{
  content:"";
  position:absolute;
  inset:10px;
  border-radius:12px;
  border:1px solid var(--edge2);
  pointer-events:none;
  opacity:.9;
}

.face.active{
  background:
    radial-gradient(800px 520px at 22% 18%, rgba(255,255,255,.18), transparent 44%),
    radial-gradient(700px 520px at 78% 86%, rgba(0,0,0,.22), transparent 54%),
    linear-gradient(180deg, #60a5fa, var(--active));
  color:var(--activeText);
  text-shadow: 0 3px 14px rgba(0,0,0,.45);
  border-color: rgba(255,255,255,.28);
  outline: 2px solid rgba(255,255,255,.16);
  outline-offset: -2px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.12),
    0 0 34px rgba(59,130,246,.55),
    0 18px 30px var(--shadow);}

/* geometry (240px => translateZ 120px) */
.face1{ transform: rotateY(0deg) translateZ(120px); }
.face2{ transform: rotateY(90deg) translateZ(120px); }
.face3{ transform: rotateY(180deg) translateZ(120px); }
.face4{ transform: rotateY(-90deg) translateZ(120px); }
.face5{ transform: rotateX(90deg) translateZ(120px); }
.face6{ transform: rotateX(-90deg) translateZ(120px); }

#controls{
  position:fixed;
  bottom:18px;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  pointer-events:none;
}

#controls > * { pointer-events:auto; }

#startBtn{
  padding:10px 18px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 26px rgba(0,0,0,.28);
}

#startBtn:hover{ background: rgba(255,255,255,.09); }

.hidden{ display:none !important; }

#hint{
  font-size:12.5px;
  color:rgba(231,233,239,.72);
}

/* mobile */
@media (max-width: 420px){
  .scene{ width:220px; height:220px; }
  .face{ width:220px; height:220px; font-size:48px; border-radius:14px; }
  .face1{ transform: rotateY(0deg) translateZ(110px); }
  .face2{ transform: rotateY(90deg) translateZ(110px); }
  .face3{ transform: rotateY(180deg) translateZ(110px); }
  .face4{ transform: rotateY(-90deg) translateZ(110px); }
  .face5{ transform: rotateX(90deg) translateZ(110px); }
  .face6{ transform: rotateX(-90deg) translateZ(110px); }
}

/* overlays */
.overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  background: radial-gradient(900px 700px at 50% 35%, rgba(10,14,24,.65), rgba(0,0,0,.72));
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index:50;
}

.card{
  width:min(560px, 92vw);
  border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(900px 500px at 20% 10%, rgba(255,255,255,.08), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  box-shadow: 0 30px 80px rgba(0,0,0,.55);
  padding:20px 18px 18px;
}

.card h1{
  margin:0 0 8px;
  font-size:34px;
  letter-spacing:.4px;
  line-height:1.1;
}

.card p{
  margin:0 0 14px;
  color:rgba(231,233,239,.78);
  line-height:1.5;
  font-size:14px;
}

.pills{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin: 12px 0 16px;
}

.pill{
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  color:rgba(231,233,239,.86);
  font-size:12.5px;
  letter-spacing:.2px;
}

.btnRow{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:flex-end;
}

.btnPrimary{
  padding:10px 16px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, #60a5fa, var(--active));
  color: #0b1020;
  font-weight:850;
  letter-spacing:.25px;
  cursor:pointer;
  box-shadow: 0 18px 30px rgba(0,0,0,.38), 0 0 30px rgba(59,130,246,.25);
}

.btnGhost{
  padding:10px 16px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  color: var(--text);
  font-weight:750;
  cursor:pointer;
}

.bigFail{
  display:flex;
  align-items:baseline;
  gap:10px;
  margin: 8px 0 10px;
}
.bigFail .label{
  font-size:14px;
  color:rgba(231,233,239,.72);
}
.bigFail .value{
  font-size:18px;
  font-weight:850;
}


/* Universal back button */
#backToHome{
  position:fixed; right:16px; top:16px;
  padding:10px 16px;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  color: #ffffff;
  font: 600 13px/1 system-ui, sans-serif;
  z-index:9999;
  cursor:pointer;
  transition:all .15s ease;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:6px;
}
#backToHome:hover{
  background: rgba(255,255,255,0.15);
  border-color: rgba(255,255,255,0.4);
  transform:translateY(-1px);
}
#backToHome:active{transform:scale(0.97);}
@media (max-width:640px){
  #backToHome{padding:8px 12px; font-size:12px; right:12px; top:12px;}
}
</style>
</head>
<body>
<a id="backToHome" href="index.html" title="Back to Homepage">
  <span>←</span>
  <span>Home</span>
</a>
<div id="startOverlay" class="overlay">
  <div class="card">
    <h1>Cube Memory</h1>
    <p>Watch the cube flash, then repeat the sequence. Each round adds one more step.</p>
    <div class="pills">
      <div class="pill">Keys: 1–6</div>
      <div class="pill">Enter: Start / Restart</div>
      <div class="pill">Space vibes: floating cube</div>
    </div>
    <div class="btnRow">
      <button id="startBtnOverlay" class="btnPrimary">Start</button>
    </div>
  </div>
</div>

<div id="gameOverOverlay" class="overlay hidden" aria-hidden="true">
  <div class="card">
    <h1>Game Over</h1>
    <p>You missed the sequence.</p>
    <div class="bigFail">
      <div class="label">Best round:</div>
      <div id="bestRound" class="value">0</div>
    </div>
    <div class="pills">
      <div class="pill">Press Enter to restart</div>
      <div class="pill">Or click Restart</div>
    </div>
    <div class="btnRow">
      <button id="restartBtn" class="btnPrimary">Restart</button>
      <button id="closeBtn" class="btnGhost">Close</button>
    </div>
  </div>
</div>

<div id="app">
  <div id="hud">
    <div id="round">Round: 0</div>
    <div id="status">Press Enter to start</div>
  </div>

  <div class="scene">
    <div class="cube">
      <div class="face face1" data-face="1">1</div>
      <div class="face face2" data-face="2">2</div>
      <div class="face face3" data-face="3">3</div>
      <div class="face face4" data-face="4">4</div>
      <div class="face face5" data-face="5">5</div>
      <div class="face face6" data-face="6">6</div>
    </div>
  </div>

  <div id="controls">
    <button id="startBtn">Start Game</button>
    <div id="hint">Keys: 1–6 • Enter to restart</div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const faces = Array.from(document.querySelectorAll(".face"));
  const cube = document.querySelector(".cube");

  const scene = document.querySelector(".scene");
  const statusEl = document.getElementById("status");
  const roundEl = document.getElementById("round");
  const startBtn = document.getElementById("startBtn");

  const startOverlay = document.getElementById("startOverlay");
  const gameOverOverlay = document.getElementById("gameOverOverlay");
  const startBtnOverlay = document.getElementById("startBtnOverlay");
  const restartBtn = document.getElementById("restartBtn");
  const closeBtn = document.getElementById("closeBtn");
  const bestRoundEl = document.getElementById("bestRound");

  let audioCtx = null;
  let sequence = [];
  let userIndex = 0;
  let round = 0;
  let state = "idle";
  showStart();

  function initAudio() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
  }

  function playTone(faceNum) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = 220 + faceNum * 60;
    gain.gain.setValueAtTime(0.001, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.35);
  }

  function setFocus(faceNum) {
    let fx = 0, fy = 0;
    switch (faceNum) {
      case 1: fx = 0; fy = 0; break;
      case 2: fx = 0; fy = -90; break;
      case 3: fx = 0; fy = -180; break;
      case 4: fx = 0; fy = 90; break;
      case 5: fx = -90; fy = 0; break;
      case 6: fx = 90; fy = 0; break;
    }
    cube.style.setProperty("--focusX", fx + "deg");
    cube.style.setProperty("--focusY", fy + "deg");
  }

  function flashFace(faceNum, duration = 400) {
    const face = faces.find(f => f.dataset.face == faceNum);
    if (!face) return;

    // VISUAL-ONLY: pause cube "float" while a face is flashing for snappier feedback
    if (scene) scene.classList.add("playing");

    setFocus(faceNum);
    face.classList.add("active");
    playTone(faceNum);

    setTimeout(() => {
      face.classList.remove("active");
      if (scene) scene.classList.remove("playing");
    }, duration);
  }

  function updateHUD() {
    roundEl.textContent = "Round: " + round;
  }


  function showStart() {
    if (gameOverOverlay) gameOverOverlay.classList.add("hidden");
    if (startOverlay) startOverlay.classList.remove("hidden");
    startBtn.disabled = false;
    startBtn.classList.remove("hidden");
    statusEl.textContent = "Press Enter to start";
  }

  function hideStart() {
    if (startOverlay) startOverlay.classList.add("hidden");
    startBtn.classList.add("hidden");
  }

  function showGameOver() {
    if (startOverlay) startOverlay.classList.add("hidden");
    if (gameOverOverlay) gameOverOverlay.classList.remove("hidden");
    if (bestRoundEl) bestRoundEl.textContent = String(round);
    statusEl.textContent = "Game Over — Press Enter";
    startBtn.disabled = false;
    startBtn.classList.remove("hidden");
  }


  function nextRound() {
    round++;
    updateHUD();
    userIndex = 0;
    sequence.push(Math.floor(Math.random() * 6) + 1);
    playSequence();
  }

  function playSequence() {
    state = "watching";
    statusEl.textContent = "Watching";
    let i = 0;
    const interval = setInterval(() => {
      flashFace(sequence[i]);
      i++;
      if (i >= sequence.length) {
        clearInterval(interval);
        setTimeout(() => {
          state = "input";
          statusEl.textContent = "Your turn";
        }, 500);
      }
    }, 700);
  }

  function resetGame() {
    initAudio();
    sequence = [];
    round = 0;
    userIndex = 0;
    updateHUD();
    hideStart();
    if (gameOverOverlay) gameOverOverlay.classList.add("hidden");
    startBtn.disabled = true;
    setFocus(1);
    nextRound();
  }

  function failGame() {
    state = "fail";
    // quick obvious fail: flash all faces once
    if (scene) scene.classList.add("playing");
    faces.forEach(f => f.classList.add("active"));
    setTimeout(() => {
      faces.forEach(f => f.classList.remove("active"));
      if (scene) scene.classList.remove("playing");
      showGameOver();
    }, 350);
  }

  startBtn.addEventListener("click", resetGame);
  if (startBtnOverlay) startBtnOverlay.addEventListener("click", resetGame);
  if (restartBtn) restartBtn.addEventListener("click", resetGame);
  if (closeBtn) closeBtn.addEventListener("click", () => {
    if (gameOverOverlay) gameOverOverlay.classList.add("hidden");
    showStart();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      if (state === "idle" || state === "fail") {
        resetGame();
      }
      return;
    }
    if (state !== "input") return;
    const num = parseInt(e.key, 10);
    if (num >= 1 && num <= 6) {
      flashFace(num, 200);
      if (num === sequence[userIndex]) {
        userIndex++;
        if (userIndex >= sequence.length) setTimeout(nextRound, 600);
      } else {
        failGame();
      }
    }
  });
});
</script>
</body>
</html>
